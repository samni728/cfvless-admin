# ğŸ“‹ NAT64 VLESSä»£ç†é¡¹ç›®æŠ€æœ¯åˆ†æç¬”è®°

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºCloudflare Workersçš„NAT64 VLESSä»£ç†é¡¹ç›®ï¼Œä¸“é—¨è®¾è®¡ç”¨äºåœ¨IPv6ç¯å¢ƒä¸‹é€šè¿‡NAT64æŠ€æœ¯è®¿é—®IPv4èµ„æºï¼Œå¹¶æä¾›å¤šç§å®¢æˆ·ç«¯è®¢é˜…æ ¼å¼ã€‚

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æ¶æ„

### 1. NAT64æŠ€æœ¯å®ç°

**æ ¸å¿ƒåŸç†ï¼š**
- NAT64æ˜¯ä¸€ç§IPv6åˆ°IPv4çš„è½¬æ¢æŠ€æœ¯
- å½“ç›´è¿IPv4å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨é€šè¿‡NAT64 IPv6åœ°å€é‡è¯•è¿æ¥
- ä½¿ç”¨å›ºå®šçš„NAT64å‰ç¼€ï¼š`2602:fc59:b0:64::`

**å…³é”®ä»£ç é€»è¾‘ï¼š**
```javascript
// NAT64 IPv6åœ°å€è½¬æ¢å‡½æ•° (ç¬¬249-265è¡Œ)
function convertToNAT64IPv6(ipv4Address) {
    const parts = ipv4Address.split('.');
    const hex = parts.map(part => {
        const num = parseInt(part, 10);
        return num.toString(16).padStart(2, '0');
    });
    const prefixes = ['2602:fc59:b0:64::'];
    const chosenPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];
    return `[${chosenPrefix}${hex[0]}${hex[1]}:${hex[2]}${hex[3]}]`;
}
```

**DNSè§£æä¸NAT64è½¬æ¢æµç¨‹ï¼š**
```javascript
// è·å–IPv6ä»£ç†åœ°å€ (ç¬¬267-287è¡Œ)
async function getIPv6ProxyAddress(domain) {
    // 1. é€šè¿‡Cloudflare DoHæŸ¥è¯¢Aè®°å½•
    const dnsQuery = await fetch(`https://1.1.1.1/dns-query?name=${domain}&type=A`);
    // 2. æå–IPv4åœ°å€
    const ipv4Address = aRecord.data;
    // 3. è½¬æ¢ä¸ºNAT64 IPv6åœ°å€
    return convertToNAT64IPv6(ipv4Address);
}
```

### 2. VLESSåè®®å¤„ç†

**åè®®è§£æï¼š**
```javascript
// VLESSå¤´éƒ¨è§£æ (ç¬¬369-435è¡Œ)
function parseVlessHeader(buffer, userID) {
    // éªŒè¯ç‰ˆæœ¬å·ã€UUIDã€é€‰é¡¹é•¿åº¦
    // è§£æå‘½ä»¤ç±»å‹ï¼ˆTCP=1, UDP=2ï¼‰
    // è§£æç›®æ ‡åœ°å€ï¼ˆIPv4/åŸŸå/IPv6ï¼‰å’Œç«¯å£
    // è¿”å›è§£æç»“æœ
}
```

**è¿æ¥é‡è¯•æœºåˆ¶ï¼š**
```javascript
// è¿æ¥å¤±è´¥æ—¶çš„NAT64é‡è¯• (ç¬¬289-315è¡Œ)
async function retry() {
    const proxyIP = await getIPv6ProxyAddress(result.addressRemote);
    console.log(`å°è¯•é€šè¿‡NAT64 IPv6åœ°å€ ${proxyIP} è¿æ¥...`);
    const tcpSocket = await connect({
        hostname: proxyIP,
        port: result.portRemote
    });
}
```

### 3. é¢„å®šä¹‰IPå’Œç«¯å£é…ç½®

**IPåœ°å€æ± ï¼š**
- HTTP IPæ± ï¼š7ä¸ªVisaåŸŸåï¼ˆIP1-IP7ï¼‰
- HTTPS IPæ± ï¼š6ä¸ªVisaåŸŸåï¼ˆIP8-IP13ï¼‰
- æ‰€æœ‰IPéƒ½ç»è¿‡Unicodeç¼–ç æ··æ·†

**ç«¯å£é…ç½®ï¼š**
- HTTPç«¯å£ï¼š80, 8080, 8880, 2052, 2082, 2086, 2095
- HTTPSç«¯å£ï¼š443, 8443, 2053, 2083, 2087, 2096

## ğŸŒ è®¢é˜…ç”Ÿæˆç³»ç»Ÿ

### 1. è·¯ç”±ç»“æ„

```javascript
// ä¸»è¦è®¢é˜…è·¯å¾„
/${userID}        // ä¸»é¡µé¢ï¼Œæ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯
/${userID}/ty     // é€šç”¨è®¢é˜…ï¼ˆBase64ç¼–ç ï¼‰
/${userID}/cl     // Clashè®¢é˜…
/${userID}/sb     // Sing-boxè®¢é˜…
/${userID}/pty    // Pagesä¸“ç”¨é€šç”¨è®¢é˜…
/${userID}/pcl    // Pagesä¸“ç”¨Clashè®¢é˜…
/${userID}/psb    // Pagesä¸“ç”¨Sing-boxè®¢é˜…
```

### 2. èŠ‚ç‚¹ç”Ÿæˆé€»è¾‘

**WorkersåŸŸåèŠ‚ç‚¹ï¼š**
- åŒ…å«HTTP + HTTPSå…±13ä¸ªç«¯å£çš„èŠ‚ç‚¹
- æ”¯æŒTLSå’ŒéTLSä¸¤ç§æ¨¡å¼

**Pages/è‡ªå®šä¹‰åŸŸåèŠ‚ç‚¹ï¼š**
- ä»…åŒ…å«HTTPSçš„6ä¸ªç«¯å£èŠ‚ç‚¹
- å¼ºåˆ¶å¯ç”¨TLSåŠ å¯†

### 3. è®¢é˜…æ ¼å¼è¯¦è§£

**é€šç”¨è®¢é˜…æ ¼å¼ï¼ˆBase64ï¼‰ï¼š**
```javascript
// ç”ŸæˆVLESSé“¾æ¥å¹¶Base64ç¼–ç 
const vlessLink = `vless://${userID}@${IP}:${PORT}?encryption=none&security=tls&type=ws&host=${hostName}&path=%2F%3Fed%3D2560#CF_V${index}_${IP}_${PORT}`;
const subscription = btoa(vlessLinks.join('\n'));
```

**Clashè®¢é˜…æ ¼å¼ï¼š**
```yaml
# åŒ…å«å®Œæ•´çš„Clashé…ç½®
proxies:
- name: CF_V1_${IP1}_${PT1}
  type: vless
  server: ${IP1}
  port: ${PT1}
  uuid: ${userID}
  network: ws
  ws-opts:
    path: "/?ed=2560"
    headers:
      Host: ${hostName}
```

**Sing-boxè®¢é˜…æ ¼å¼ï¼š**
```json
{
  "outbounds": [
    {
      "server": "${IP}",
      "server_port": ${PORT},
      "tag": "CF_V${index}_${IP}_${PORT}",
      "type": "vless",
      "uuid": "${userID}",
      "transport": {
        "type": "ws",
        "path": "/?ed=2560",
        "headers": {"Host": ["${hostName}"]}
      }
    }
  ]
}
```

## ğŸ”„ æ•°æ®æµå¤„ç†

### 1. WebSocketå¤„ç†æµç¨‹

```javascript
// WebSocketæ•°æ®æµ (ç¬¬190-340è¡Œ)
1. æ¥æ”¶WebSocketè¿æ¥
2. è§£æVLESSåè®®å¤´éƒ¨
3. å°è¯•ç›´è¿ç›®æ ‡åœ°å€
4. è¿æ¥å¤±è´¥æ—¶å¯åŠ¨NAT64é‡è¯•
5. å»ºç«‹æ•°æ®è½¬å‘ç®¡é“
```

### 2. UDP DNSå¤„ç†

```javascript
// DNSæŸ¥è¯¢å¤„ç† (ç¬¬491-546è¡Œ)
if (result.portRemote === 53) {
    isDns = true;
    // è½¬å‘DNSæŸ¥è¯¢åˆ°1.1.1.1
    const resp = await fetch('https://1.1.1.1/dns-query', {
        method: 'POST',
        headers: {'content-type': 'application/dns-message'},
        body: chunk
    });
}
```

## ğŸ¨ å‰ç«¯ç•Œé¢ç‰¹æ€§

### 1. Bootstrapå“åº”å¼è®¾è®¡
- ä½¿ç”¨Bootstrap 5.3.3æ¡†æ¶
- å“åº”å¼è¡¨æ ¼å’ŒæŒ‰é’®å¸ƒå±€
- ä¸€é”®å¤åˆ¶åŠŸèƒ½

### 2. èŠ‚ç‚¹å±•ç¤ºé€»è¾‘
- æ ¹æ®åŸŸåç±»å‹æ˜¾ç¤ºä¸åŒèŠ‚ç‚¹é›†åˆ
- WorkersåŸŸåï¼šæ˜¾ç¤ºHTTP+HTTPSèŠ‚ç‚¹
- è‡ªå®šä¹‰åŸŸåï¼šä»…æ˜¾ç¤ºHTTPSèŠ‚ç‚¹

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### 1. UUIDéªŒè¯
```javascript
// ä¸¥æ ¼çš„UUIDéªŒè¯
if (uuid !== userID) {
    return { hasError: true, message: 'æ— æ•ˆçš„ç”¨æˆ·' };
}
```

### 2. åè®®é™åˆ¶
- ä»…æ”¯æŒTCPå’ŒUDPï¼ˆç«¯å£53 DNSï¼‰
- å…¶ä»–UDPæµé‡è¢«æ‹’ç»

### 3. TLSé…ç½®
- æ”¯æŒTLS/éTLSåŒæ¨¡å¼
- åŒ…å«SNIå’ŒæŒ‡çº¹ä¼ªè£…

## ğŸš€ éƒ¨ç½²é…ç½®

### 1. ç¯å¢ƒå˜é‡æ”¯æŒ
```javascript
// æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è‡ªå®šä¹‰æ‰€æœ‰IPå’Œç«¯å£
userID = env.uuid || userID;
IP1 = env.ip1 || IP1;
PT1 = env.pt1 || PT1;
// ... æ”¯æŒ13ä¸ªIPå’Œ13ä¸ªç«¯å£çš„è‡ªå®šä¹‰
```

### 2. åå‘ä»£ç†åŠŸèƒ½
- æ”¯æŒéšæœºåŸŸååå‘ä»£ç†
- åŒ…å«è¯·æ±‚å¤´ä¼ªè£…
- é˜²æ­¢é‡å®šå‘æ”»å‡»

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

1. **è‡ªåŠ¨æ•…éšœè½¬ç§»**ï¼šIPv4è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°NAT64 IPv6
2. **å¤šæ ¼å¼æ”¯æŒ**ï¼šåŒæ—¶æ”¯æŒé€šç”¨ã€Clashã€Sing-boxä¸‰ç§è®¢é˜…æ ¼å¼
3. **çµæ´»é…ç½®**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡æ”¯æŒå®Œå…¨è‡ªå®šä¹‰IPå’Œç«¯å£
4. **æ™ºèƒ½è·¯ç”±**ï¼šæ ¹æ®åŸŸåç±»å‹è‡ªåŠ¨é€‰æ‹©èŠ‚ç‚¹é›†åˆ
5. **å®‰å…¨åŠ å›º**ï¼šåŒ…å«å¤šå±‚éªŒè¯å’Œåè®®é™åˆ¶

## ğŸ”® é€‚ç”¨åœºæ™¯

- **IPv6ä¼˜å…ˆç½‘ç»œ**ï¼šåœ¨IPv6ç¯å¢ƒä¸‹è®¿é—®IPv4èµ„æº
- **æ•™è‚²ç½‘ç¯å¢ƒ**ï¼šåˆ©ç”¨æ•™è‚²ç½‘IPv6å…æµç‰¹æ€§
- **ç§»åŠ¨ç½‘ç»œ**ï¼šæŸäº›ç§»åŠ¨è¿è¥å•†çš„IPv6ç½‘ç»œç¯å¢ƒ
- **Cloudflareä¼˜åŒ–**ï¼šå……åˆ†åˆ©ç”¨CFçš„å…¨çƒç½‘ç»œ

## ğŸ“ å¼€å‘è¦ç‚¹æ€»ç»“

### å…³é”®æŠ€æœ¯æ ˆ
- **Cloudflare Workers**ï¼šæ— æœåŠ¡å™¨è®¡ç®—å¹³å°
- **NAT64**ï¼šIPv6åˆ°IPv4åœ°å€è½¬æ¢æŠ€æœ¯
- **VLESSåè®®**ï¼šè½»é‡çº§ä»£ç†åè®®
- **WebSocket**ï¼šå®æ—¶åŒå‘é€šä¿¡
- **DNS over HTTPS**ï¼šå®‰å…¨DNSæŸ¥è¯¢

### æ ¸å¿ƒç®—æ³•
1. **IPv4åˆ°NAT64 IPv6è½¬æ¢ç®—æ³•**
2. **VLESSåè®®è§£æç®—æ³•**
3. **è‡ªåŠ¨é‡è¯•æœºåˆ¶**
4. **å¤šæ ¼å¼è®¢é˜…ç”Ÿæˆç®—æ³•**

### æ€§èƒ½ä¼˜åŒ–
- è¿æ¥æ± å¤ç”¨
- å¼‚æ­¥å¹¶å‘å¤„ç†
- æ™ºèƒ½æ•…éšœè½¬ç§»
- ç¼“å­˜æœºåˆ¶

è¿™ä¸ªé¡¹ç›®å·§å¦™åœ°ç»“åˆäº†NAT64æŠ€æœ¯å’ŒVLESSåè®®ï¼Œä¸ºIPv6ç¯å¢ƒä¸‹çš„ä»£ç†è®¿é—®æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸ”„ ProxyIPç‰ˆæœ¬å¯¹æ¯”åˆ†æ (vlessnoproxyip.js)

### ğŸ“‹ ç‰ˆæœ¬å·®å¼‚æ¦‚è¿°

`vlessnoproxyip.js` æ˜¯ `_workernat64.js` çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä¸»è¦å·®å¼‚ï¼š

**ç§»é™¤çš„åŠŸèƒ½ï¼š**
- âŒ NAT64è‡ªåŠ¨è½¬æ¢æœºåˆ¶
- âŒ IPv6æ•…éšœè½¬ç§»é€»è¾‘
- âŒ DNS over HTTPSæŸ¥è¯¢

**ä¿ç•™çš„åŠŸèƒ½ï¼š**
- âœ… è‡ªå®šä¹‰ProxyIPæ”¯æŒ
- âœ… å¤šæ ¼å¼è®¢é˜…ç”Ÿæˆ
- âœ… VLESSåè®®å¤„ç†
- âœ… ç¯å¢ƒå˜é‡é…ç½®

### ğŸ¯ ProxyIPæ ¸å¿ƒå®ç°

#### 1. ProxyIPé…ç½®æœºåˆ¶

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**
```javascript
// ç¬¬8è¡Œï¼šProxyIPæ•°ç»„å®šä¹‰
const proxyIPs = [""];

// ç¬¬45-46è¡Œï¼šéšæœºé€‰æ‹©å’Œç«¯å£è§£æ
let proxyIP = proxyIPs[Math.floor(Math.random() * proxyIPs.length)];
let proxyPort = proxyIP.match(/:(\d+)$/) ? proxyIP.match(/:(\d+)$/)[1] : '443';
```

**ç¯å¢ƒå˜é‡è¦†ç›–é€»è¾‘ (ç¬¬61-88è¡Œ)ï¼š**
```javascript
const { proxyip } = env;
if (proxyip) {
    // IPv6åœ°å€æ ¼å¼å¤„ç†ï¼š[IPv6]:port
    if (proxyip.includes(']:')) {
        let lastColonIndex = proxyip.lastIndexOf(':');
        proxyPort = proxyip.slice(lastColonIndex + 1);
        proxyIP = proxyip.slice(0, lastColonIndex);
    } 
    // IPv4åœ°å€æ ¼å¼å¤„ç†ï¼šIPv4:port
    else if (!proxyip.includes(']:') && !proxyip.includes(']')) {
        [proxyIP, proxyPort = '443'] = proxyip.split(':');
    } 
    // çº¯IPv6åœ°å€ï¼šé»˜è®¤443ç«¯å£
    else {
        proxyPort = '443';
        proxyIP = proxyip;
    }
}
```

#### 2. åŠ¨æ€ProxyIPè®¾ç½®

**URLè·¯å¾„å‚æ•°æ”¯æŒ (ç¬¬221-237è¡Œ)ï¼š**
```javascript
// æ”¯æŒé€šè¿‡URLåŠ¨æ€è®¾ç½®ProxyIPï¼š/pyip=IP:PORT
if(url.pathname.includes('/pyip=')) {
    const tmp_ip = url.pathname.split("=")[1];
    if(isValidIP(tmp_ip)) {
        proxyIP = tmp_ip;
        // é‡æ–°è§£æIPå’Œç«¯å£
        if (proxyIP.includes(']:')) {
            let lastColonIndex = proxyIP.lastIndexOf(':');
            proxyPort = proxyIP.slice(lastColonIndex + 1);
            proxyIP = proxyIP.slice(0, lastColonIndex);	
        } else if (!proxyIP.includes(']:') && !proxyIP.includes(']')) {
            [proxyIP, proxyPort = '443'] = proxyIP.split(':');
        } else {
            proxyPort = '443';
        }
    }	
}
```

#### 3. ProxyIPè¿æ¥é€»è¾‘

**TCPè¿æ¥å¤„ç† (ç¬¬409-443è¡Œ)ï¼š**
```javascript
async function handleTCPOutBound() {
    // ç›´è¿ç›®æ ‡åœ°å€
    const tcpSocket = await connectAndWrite(addressRemote, portRemote);
    
    // è¿æ¥å¤±è´¥æ—¶çš„ProxyIPé‡è¯•æœºåˆ¶
    async function retry() {
        // ä½¿ç”¨ProxyIPè¿›è¡Œé‡è¯•è¿æ¥
        const tcpSocket = await connectAndWrite(
            proxyIP || addressRemote,    // ä¼˜å…ˆä½¿ç”¨ProxyIP
            proxyPort || portRemote      // ä¼˜å…ˆä½¿ç”¨ProxyPort
        );
        // å»ºç«‹æ•°æ®è½¬å‘
        remoteSocketToWS(tcpSocket, webSocket, cloudflareResponseHeader, null, log);
    }
}
```

**å…³é”®ç‰¹æ€§ï¼š**
- **æ™ºèƒ½åœ°å€å¤„ç†**ï¼šè‡ªåŠ¨è¯†åˆ«IPv4/IPv6æ ¼å¼
- **ç«¯å£è§£æ**ï¼šæ”¯æŒåœ°å€:ç«¯å£æ ¼å¼
- **æ•…éšœè½¬ç§»**ï¼šç›´è¿å¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨ProxyIP
- **åŠ¨æ€é…ç½®**ï¼šæ”¯æŒURLå‚æ•°å’Œç¯å¢ƒå˜é‡

#### 4. ä¸NAT64ç‰ˆæœ¬çš„å¯¹æ¯”

| ç‰¹æ€§ | NAT64ç‰ˆæœ¬ | ProxyIPç‰ˆæœ¬ |
|------|-----------|-------------|
| **æ•…éšœè½¬ç§»** | NAT64 IPv6è½¬æ¢ | è‡ªå®šä¹‰ProxyIP |
| **åœ°å€è§£æ** | DNS over HTTPS | ç›´æ¥ä½¿ç”¨é…ç½® |
| **é€‚ç”¨åœºæ™¯** | IPv6ç¯å¢ƒ | é€šç”¨ä»£ç†ç¯å¢ƒ |
| **é…ç½®å¤æ‚åº¦** | è‡ªåŠ¨åŒ– | æ‰‹åŠ¨é…ç½® |
| **çµæ´»æ€§** | å›ºå®šNAT64å‰ç¼€ | å®Œå…¨è‡ªå®šä¹‰ |

### ğŸ’¡ ProxyIPä½¿ç”¨åœºæ™¯

1. **CDNä¼˜é€‰**ï¼šä½¿ç”¨ä¼˜é€‰çš„CDN IPä½œä¸ºProxyIP
2. **è´Ÿè½½å‡è¡¡**ï¼šé…ç½®å¤šä¸ªProxyIPå®ç°è´Ÿè½½åˆ†æ‹…
3. **åœ°åŒºä¼˜åŒ–**ï¼šé’ˆå¯¹ä¸åŒåœ°åŒºé…ç½®æœ€ä¼˜ProxyIP
4. **æ•…éšœæ¢å¤**ï¼šå½“ç›´è¿å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°ProxyIP

### ğŸ”§ é…ç½®ç¤ºä¾‹

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**
```bash
# IPv4 ProxyIP
proxyip=1.2.3.4:443

# IPv6 ProxyIP  
proxyip=[2001:db8::1]:443

# åŸŸå ProxyIP
proxyip=proxy.example.com:8443
```

**URLåŠ¨æ€é…ç½®ï¼š**
```
https://worker.domain.com/pyip=1.2.3.4:443
```

è¿™ä¸ªProxyIPç‰ˆæœ¬ä¸ºä¸éœ€è¦NAT64åŠŸèƒ½ä½†éœ€è¦çµæ´»ä»£ç†é…ç½®çš„åœºæ™¯æä¾›äº†å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸ” NAT64 vs ProxyIP ä»£ç†æœºåˆ¶æ·±åº¦åˆ†æ

### ğŸŒ é—®é¢˜èƒŒæ™¯

ç”±äºCloudflareçš„CDNç­–ç•¥ï¼Œé€šè¿‡CF Workerséƒ¨ç½²çš„VLESSèŠ‚ç‚¹æ— æ³•ç›´æ¥è®¿é—®Cloudflareè‡ªèº«çš„CDNç½‘ç«™ï¼ˆå¦‚ChatGPTã€X.comã€cloudflare.comç­‰ï¼‰ï¼Œå› æ­¤éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼ç»•è¿‡è¿™ä¸ªé™åˆ¶ã€‚

### ğŸ”„ NAT64ç‰ˆæœ¬çš„ä»£ç†é€»è¾‘

#### ğŸ“¡ NAT64å·¥ä½œåŸç†

**ç¬¬1æ­¥ï¼šç›´è¿å°è¯•**
```javascript
// ç¬¬318è¡Œï¼šå…ˆå°è¯•ç›´è¿ç›®æ ‡åœ°å€
const tcpSocket = await connectAndWrite(result.addressRemote, result.portRemote);
```

**ç¬¬2æ­¥ï¼šå¤±è´¥æ—¶çš„NAT64è½¬æ¢**
```javascript
// ç¬¬289-315è¡Œï¼šNAT64é‡è¯•æœºåˆ¶
async function retry() {
    // 1. é€šè¿‡DNS over HTTPSæŸ¥è¯¢ç›®æ ‡åŸŸåçš„IPv4åœ°å€
    const dnsQuery = await fetch(`https://1.1.1.1/dns-query?name=${domain}&type=A`);
    
    // 2. å°†IPv4åœ°å€è½¬æ¢ä¸ºNAT64 IPv6åœ°å€
    const proxyIP = await getIPv6ProxyAddress(result.addressRemote);
    // ä¾‹å¦‚ï¼š1.2.3.4 â†’ [2602:fc59:b0:64::0102:0304]
    
    // 3. é€šè¿‡NAT64 IPv6åœ°å€å»ºç«‹TCPè¿æ¥
    const tcpSocket = await connect({
        hostname: proxyIP,  // IPv6åœ°å€
        port: result.portRemote
    });
}
```

**NAT64åœ°å€è½¬æ¢ç®—æ³•ï¼š**
```javascript
// ç¬¬249-265è¡Œï¼šIPv4åˆ°NAT64 IPv6è½¬æ¢
function convertToNAT64IPv6(ipv4Address) {
    const parts = ipv4Address.split('.'); // [1, 2, 3, 4]
    const hex = parts.map(part => parseInt(part, 10).toString(16).padStart(2, '0'));
    // ç»“æœï¼š[01, 02, 03, 04]
    
    const prefix = '2602:fc59:b0:64::';
    return `[${prefix}${hex[0]}${hex[1]}:${hex[2]}${hex[3]}]`;
    // æœ€ç»ˆï¼š[2602:fc59:b0:64::0102:0304]
}
```

**NAT64ä»£ç†ç±»å‹ï¼šç½‘ç»œå±‚è½¬æ¢**
- **ä¸æ˜¯ä¼ ç»Ÿä»£ç†**ï¼šNAT64æ˜¯ç½‘ç»œå±‚çš„åœ°å€è½¬æ¢æŠ€æœ¯
- **é€æ˜è½¬æ¢**ï¼šç›´æ¥å»ºç«‹TCPè¿æ¥åˆ°è½¬æ¢åçš„IPv6åœ°å€
- **åè®®**ï¼šçº¯TCPè¿æ¥ï¼Œæ— éœ€HTTP/SOCKSä»£ç†åè®®

### ğŸ¯ ProxyIPç‰ˆæœ¬çš„ä»£ç†é€»è¾‘

#### ğŸ”— ProxyIPå·¥ä½œåŸç†

**ç¬¬1æ­¥ï¼šç›´è¿å°è¯•**
```javascript
// ç¬¬438è¡Œï¼šå…ˆå°è¯•ç›´è¿ç›®æ ‡åœ°å€
const tcpSocket = await connectAndWrite(addressRemote, portRemote);
```

**ç¬¬2æ­¥ï¼šå¤±è´¥æ—¶çš„ProxyIPé‡è¯•**
```javascript
// ç¬¬425-436è¡Œï¼šProxyIPé‡è¯•æœºåˆ¶
async function retry() {
    // ç›´æ¥é€šè¿‡ProxyIPå»ºç«‹TCPè¿æ¥
    const tcpSocket = await connectAndWrite(
        proxyIP || addressRemote,    // ä½¿ç”¨ProxyIPåœ°å€
        proxyPort || portRemote      // ä½¿ç”¨ProxyIPç«¯å£
    );
}
```

**ProxyIPä»£ç†ç±»å‹ï¼šTCPå±‚ä¸­è½¬**
- **ä¸æ˜¯HTTPä»£ç†**ï¼šä¸ä½¿ç”¨HTTP CONNECTæ–¹æ³•
- **ä¸æ˜¯SOCKSä»£ç†**ï¼šä¸ä½¿ç”¨SOCKS4/5åè®®
- **çº¯TCPä¸­è½¬**ï¼šç›´æ¥å»ºç«‹TCPè¿æ¥åˆ°ProxyIPï¼Œç„¶åé€æ˜è½¬å‘æ•°æ®

### ğŸ“Š ä»£ç†æœºåˆ¶è¯¦ç»†å¯¹æ¯”

| ç‰¹æ€§ | NAT64ç‰ˆæœ¬ | ProxyIPç‰ˆæœ¬ |
|------|-----------|-------------|
| **ä»£ç†åè®®** | æ— ï¼ˆç½‘ç»œå±‚è½¬æ¢ï¼‰ | æ— ï¼ˆTCPå±‚ä¸­è½¬ï¼‰ |
| **å·¥ä½œå±‚çº§** | ç½‘ç»œå±‚ï¼ˆIPv6/IPv4è½¬æ¢ï¼‰ | ä¼ è¾“å±‚ï¼ˆTCPè½¬å‘ï¼‰ |
| **åœ°å€è§£æ** | DNS over HTTPSè‡ªåŠ¨æŸ¥è¯¢ | ç›´æ¥ä½¿ç”¨é…ç½®çš„IP/åŸŸå |
| **è¿æ¥æ–¹å¼** | TCP â†’ NAT64 IPv6åœ°å€ | TCP â†’ ProxyIPåœ°å€ |
| **é…ç½®å¤æ‚åº¦** | è‡ªåŠ¨åŒ–ï¼ˆæ— éœ€é…ç½®ï¼‰ | æ‰‹åŠ¨é…ç½®ProxyIP |
| **é€‚ç”¨ç¯å¢ƒ** | IPv6ç½‘ç»œç¯å¢ƒ | ä»»ä½•ç½‘ç»œç¯å¢ƒ |
| **æ•…éšœè½¬ç§»** | è‡ªåŠ¨IPv4â†’IPv6è½¬æ¢ | æ‰‹åŠ¨æŒ‡å®šä¸­è½¬èŠ‚ç‚¹ |

### ğŸ”§ å®é™…æ•°æ®æµå‘

#### NAT64æ•°æ®æµï¼š
```
å®¢æˆ·ç«¯ â†’ CF Workers â†’ NAT64ç½‘å…³ â†’ ç›®æ ‡æœåŠ¡å™¨
       (VLESS/WS)   (IPv6â†’IPv4è½¬æ¢)  (åŸå§‹IPv4)
```

#### ProxyIPæ•°æ®æµï¼š
```
å®¢æˆ·ç«¯ â†’ CF Workers â†’ ProxyIPæœåŠ¡å™¨ â†’ ç›®æ ‡æœåŠ¡å™¨
       (VLESS/WS)   (TCPä¸­è½¬)        (TCPè½¬å‘)
```

### ğŸ’¡ å…³é”®æŠ€æœ¯ç»†èŠ‚

#### NAT64æœºåˆ¶ï¼š
- **æœ¬è´¨**ï¼šåˆ©ç”¨NAT64ç½‘å…³è¿›è¡ŒIPv6åˆ°IPv4çš„ç½‘ç»œå±‚è½¬æ¢
- **ä¼˜åŠ¿**ï¼šå®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€é¢å¤–é…ç½®
- **é™åˆ¶**ï¼šä¾èµ–NAT64åŸºç¡€è®¾æ–½
- **NAT64å‰ç¼€**ï¼š`2602:fc59:b0:64::`ï¼ˆå›ºå®šï¼‰

#### ProxyIPæœºåˆ¶ï¼š
- **æœ¬è´¨**ï¼šä½¿ç”¨æŒ‡å®šçš„IP/åŸŸåä½œä¸ºTCPå±‚ä¸­è½¬èŠ‚ç‚¹
- **ä¼˜åŠ¿**ï¼šçµæ´»é…ç½®ï¼Œå¯ä½¿ç”¨ä»»ä½•å¯è¾¾çš„æœåŠ¡å™¨
- **é™åˆ¶**ï¼šéœ€è¦æ‰‹åŠ¨é…ç½®å¯ç”¨çš„ä¸­è½¬èŠ‚ç‚¹
- **æ”¯æŒæ ¼å¼**ï¼šIPv4ã€IPv6ã€åŸŸåï¼ˆå¸¦ç«¯å£æˆ–é»˜è®¤443ï¼‰

#### å…±åŒç‰¹ç‚¹ï¼š
- **éƒ½ä¸æ˜¯ä¼ ç»Ÿçš„HTTP/SOCKSä»£ç†**
- **éƒ½æ˜¯TCPå±‚çš„é€æ˜è½¬å‘**
- **éƒ½ä¸éœ€è¦ç›®æ ‡æœåŠ¡å™¨æ”¯æŒç‰¹å®šä»£ç†åè®®**
- **æ•°æ®ä¼ è¾“å®Œå…¨é€æ˜ï¼Œç›®æ ‡æœåŠ¡å™¨çœ‹åˆ°çš„æ˜¯ä¸­è½¬èŠ‚ç‚¹çš„IP**
- **éƒ½èƒ½æœ‰æ•ˆç»•è¿‡Cloudflare CDNé™åˆ¶**

### ğŸ¯ ä½¿ç”¨åœºæ™¯é€‰æ‹©

**é€‰æ‹©NAT64ç‰ˆæœ¬çš„æƒ…å†µï¼š**
- IPv6ç½‘ç»œç¯å¢ƒ
- å¸Œæœ›å®Œå…¨è‡ªåŠ¨åŒ–çš„è§£å†³æ–¹æ¡ˆ
- ä¸æƒ³æ‰‹åŠ¨ç»´æŠ¤ProxyIPåˆ—è¡¨
- æ•™è‚²ç½‘æˆ–æ”¯æŒNAT64çš„ç½‘ç»œ

**é€‰æ‹©ProxyIPç‰ˆæœ¬çš„æƒ…å†µï¼š**
- ä»»ä½•ç½‘ç»œç¯å¢ƒ
- æœ‰å¯ç”¨çš„ä¸­è½¬æœåŠ¡å™¨èµ„æº
- éœ€è¦ç²¾ç¡®æ§åˆ¶ä»£ç†è·¯å¾„
- å¸Œæœ›ä½¿ç”¨ç‰¹å®šçš„ä¼˜é€‰IP

è¿™ä¸¤ç§æ–¹æ¡ˆéƒ½å·§å¦™åœ°ç»•è¿‡äº†Cloudflareçš„CDNé™åˆ¶ï¼Œä¸ºVLESSèŠ‚ç‚¹è®¿é—®CFè‡ªèº«æœåŠ¡æä¾›äº†æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼

---

## ğŸš€ é¡¹ç›®åŠŸèƒ½æ‰©å±•å¼€å‘æ–¹æ¡ˆ (åŸºäºCloudflare Workers/Pages)

### ğŸ“‹ äº§å“æ„¿æ™¯

åœ¨ç°æœ‰è®¢é˜…èšåˆç®¡ç†å¹³å°çš„åŸºç¡€ä¸Šï¼Œé›†æˆNAT64å’ŒProxyIPæºèŠ‚ç‚¹ç”ŸæˆåŠŸèƒ½ï¼Œé€šè¿‡WebUIé…ç½®ç”Ÿæˆè¿™ä¸¤ç§ç±»å‹çš„æºèŠ‚ç‚¹ï¼Œç„¶ååˆ©ç”¨ç°æœ‰çš„èŠ‚ç‚¹ç”Ÿæˆå™¨æ‰©å±•å‡ºæ›´å¤šèŠ‚ç‚¹ï¼Œå½¢æˆå®Œæ•´çš„èŠ‚ç‚¹ç”Ÿæˆå’Œç®¡ç†é—­ç¯ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ‰©å±•è§„åˆ’

#### é˜¶æ®µä¸€ï¼šæºèŠ‚ç‚¹ç”Ÿæˆå™¨ (ä¼˜å…ˆçº§ï¼šé«˜)

**1. NAT64æºèŠ‚ç‚¹ç”Ÿæˆ**
- **åŠŸèƒ½æè¿°**ï¼šåŸºäºç°æœ‰_workernat64.jsä»£ç ï¼Œç”ŸæˆNAT64ç±»å‹çš„VLESSæºèŠ‚ç‚¹
- **æŠ€æœ¯å®ç°**ï¼š
  ```javascript
  // åœ¨ç°æœ‰_worker.jsä¸­æ·»åŠ NAT64æºèŠ‚ç‚¹ç”Ÿæˆ
  function generateNAT64SourceNode(userConfig) {
    const nat64Config = {
      userID: userConfig.uuid || crypto.randomUUID(),
      hostName: userConfig.domain || 'your-worker.workers.dev',
      nat64Prefix: userConfig.nat64Prefix || '2602:fc59:b0:64::',
      enableAutoFallback: userConfig.autoFallback !== false
    };
    
    // ç”ŸæˆNAT64å¢å¼ºçš„VLESSèŠ‚ç‚¹
    return `vless://${nat64Config.userID}@${nat64Config.hostName}:443?encryption=none&security=tls&type=ws&host=${nat64Config.hostName}&path=%2F%3Fed%3D2560&sni=${nat64Config.hostName}#NAT64_Enhanced_${nat64Config.hostName}`;
  }
  ```

**2. ProxyIPæºèŠ‚ç‚¹ç”Ÿæˆ**
- **åŠŸèƒ½æè¿°**ï¼šåŸºäºç°æœ‰vlessnoproxyip.jsä»£ç ï¼Œç”ŸæˆProxyIPç±»å‹çš„VLESSæºèŠ‚ç‚¹
- **æŠ€æœ¯å®ç°**ï¼š
  ```javascript
  // ProxyIPæºèŠ‚ç‚¹ç”Ÿæˆ
  function generateProxyIPSourceNode(userConfig) {
    const proxyConfig = {
      userID: userConfig.uuid || crypto.randomUUID(),
      hostName: userConfig.domain || 'your-worker.workers.dev',
      proxyIP: userConfig.proxyIP || '',
      proxyPort: userConfig.proxyPort || '443'
    };
    
    // ç”ŸæˆProxyIPå¢å¼ºçš„VLESSèŠ‚ç‚¹
    return `vless://${proxyConfig.userID}@${proxyConfig.hostName}:443?encryption=none&security=tls&type=ws&host=${proxyConfig.hostName}&path=%2F%3Fed%3D2560&sni=${proxyConfig.hostName}#ProxyIP_Enhanced_${proxyConfig.hostName}`;
  }
  ```

**3. æ•°æ®åº“æ‰©å±•**
- **æºèŠ‚ç‚¹é…ç½®è¡¨**ï¼š
  ```sql
  -- æºèŠ‚ç‚¹é…ç½®è¡¨
  CREATE TABLE source_node_configs (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,
    config_name TEXT,
    node_type TEXT, -- 'nat64' æˆ– 'proxyip'
    config_data TEXT, -- JSONæ ¼å¼çš„é…ç½®æ•°æ®
    generated_node TEXT, -- ç”Ÿæˆçš„æºèŠ‚ç‚¹é“¾æ¥
    enabled BOOLEAN DEFAULT true,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
  );
  ```

#### é˜¶æ®µäºŒï¼šWebUIæºèŠ‚ç‚¹é…ç½®ç•Œé¢ (ä¼˜å…ˆçº§ï¼šé«˜)

**1. æºèŠ‚ç‚¹é…ç½®ç®¡ç†é¡µé¢**
- **åœ¨ç°æœ‰WebUIä¸­æ–°å¢"æºèŠ‚ç‚¹ç®¡ç†"æ ‡ç­¾é¡µ**ï¼š
  ```html
  <!-- åœ¨ç°æœ‰å¯¼èˆªä¸­æ·»åŠ  -->
  <li class="nav-item">
    <button class="nav-link" id="source-nodes-tab" data-bs-toggle="tab" data-bs-target="#source-nodes" type="button">
      ğŸ”§ æºèŠ‚ç‚¹ç®¡ç†
    </button>
  </li>
  ```

**2. NAT64æºèŠ‚ç‚¹é…ç½®é¢æ¿**
- **NAT64é…ç½®ç•Œé¢**ï¼š
  ```html
  <div class="source-node-config" id="nat64-config">
    <h4>ğŸŒ NAT64æºèŠ‚ç‚¹é…ç½®</h4>
    <div class="row">
      <div class="col-md-6">
        <label class="form-label">é…ç½®åç§°ï¼š</label>
        <input type="text" class="form-control" id="nat64-name" placeholder="ä¾‹å¦‚ï¼šNAT64-æ•™è‚²ç½‘">
      </div>
      <div class="col-md-6">
        <label class="form-label">WorkeråŸŸåï¼š</label>
        <input type="text" class="form-control" id="nat64-domain" placeholder="your-worker.workers.dev">
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-6">
        <label class="form-label">UUIDï¼š</label>
        <input type="text" class="form-control" id="nat64-uuid" placeholder="è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥">
        <button class="btn btn-sm btn-outline-secondary mt-1" onclick="generateUUID('nat64-uuid')">ğŸ² ç”ŸæˆUUID</button>
      </div>
      <div class="col-md-6">
        <label class="form-label">NAT64å‰ç¼€ï¼š</label>
        <input type="text" class="form-control" id="nat64-prefix" value="2602:fc59:b0:64::">
      </div>
    </div>
    <div class="mt-3">
      <button class="btn btn-primary" onclick="generateNAT64Node()">ğŸš€ ç”ŸæˆNAT64æºèŠ‚ç‚¹</button>
      <button class="btn btn-success ms-2" onclick="saveNAT64Config()">ğŸ’¾ ä¿å­˜é…ç½®</button>
    </div>
    <div class="mt-3">
      <label class="form-label">ç”Ÿæˆçš„æºèŠ‚ç‚¹ï¼š</label>
      <textarea class="form-control" id="nat64-result" rows="3" readonly placeholder="ç‚¹å‡»ç”ŸæˆæŒ‰é’®åæ˜¾ç¤º"></textarea>
      <button class="btn btn-outline-primary btn-sm mt-1" onclick="copyToClipboard('nat64-result')">ğŸ“‹ å¤åˆ¶èŠ‚ç‚¹</button>
    </div>
  </div>
  ```

**3. ProxyIPæºèŠ‚ç‚¹é…ç½®é¢æ¿**
- **ProxyIPé…ç½®ç•Œé¢**ï¼š
  ```html
  <div class="source-node-config" id="proxyip-config">
    <h4>ğŸ¯ ProxyIPæºèŠ‚ç‚¹é…ç½®</h4>
    <div class="row">
      <div class="col-md-6">
        <label class="form-label">é…ç½®åç§°ï¼š</label>
        <input type="text" class="form-control" id="proxyip-name" placeholder="ä¾‹å¦‚ï¼šProxyIP-ä¼˜é€‰">
      </div>
      <div class="col-md-6">
        <label class="form-label">WorkeråŸŸåï¼š</label>
        <input type="text" class="form-control" id="proxyip-domain" placeholder="your-worker.workers.dev">
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-6">
        <label class="form-label">UUIDï¼š</label>
        <input type="text" class="form-control" id="proxyip-uuid" placeholder="è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥">
        <button class="btn btn-sm btn-outline-secondary mt-1" onclick="generateUUID('proxyip-uuid')">ğŸ² ç”ŸæˆUUID</button>
      </div>
      <div class="col-md-6">
        <label class="form-label">ProxyIPåœ°å€ï¼š</label>
        <input type="text" class="form-control" id="proxyip-address" placeholder="1.2.3.4:443 æˆ– example.com:443">
        <small class="form-text text-muted">æ”¯æŒIPv4ã€IPv6ã€åŸŸåï¼Œå¯å¸¦ç«¯å£</small>
      </div>
    </div>
    <div class="mt-3">
      <button class="btn btn-primary" onclick="generateProxyIPNode()">ğŸš€ ç”ŸæˆProxyIPæºèŠ‚ç‚¹</button>
      <button class="btn btn-success ms-2" onclick="saveProxyIPConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
    </div>
    <div class="mt-3">
      <label class="form-label">ç”Ÿæˆçš„æºèŠ‚ç‚¹ï¼š</label>
      <textarea class="form-control" id="proxyip-result" rows="3" readonly placeholder="ç‚¹å‡»ç”ŸæˆæŒ‰é’®åæ˜¾ç¤º"></textarea>
      <button class="btn btn-outline-primary btn-sm mt-1" onclick="copyToClipboard('proxyip-result')">ğŸ“‹ å¤åˆ¶èŠ‚ç‚¹</button>
    </div>
  </div>
  ```

**4. å·²ä¿å­˜é…ç½®ç®¡ç†**
- **é…ç½®åˆ—è¡¨ç•Œé¢**ï¼š
  ```html
  <div class="saved-configs mt-4">
    <h4>ğŸ“‹ å·²ä¿å­˜çš„æºèŠ‚ç‚¹é…ç½®</h4>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>é…ç½®åç§°</th>
            <th>èŠ‚ç‚¹ç±»å‹</th>
            <th>åŸŸå</th>
            <th>çŠ¶æ€</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="saved-configs-list">
          <!-- åŠ¨æ€åŠ è½½å·²ä¿å­˜çš„é…ç½® -->
        </tbody>
      </table>
    </div>
  </div>
  ```

#### é˜¶æ®µä¸‰ï¼šæ ¸å¿ƒåŠŸèƒ½é›†æˆ (ä¼˜å…ˆçº§ï¼šé«˜)

**1. JavaScriptåŠŸèƒ½å®ç°**
- **æºèŠ‚ç‚¹ç”Ÿæˆå‡½æ•°**ï¼š
  ```javascript
  // UUIDç”Ÿæˆå‡½æ•°
  function generateUUID(inputId) {
    const uuid = crypto.randomUUID();
    document.getElementById(inputId).value = uuid;
  }
  
  // NAT64æºèŠ‚ç‚¹ç”Ÿæˆ
  async function generateNAT64Node() {
    const config = {
      name: document.getElementById('nat64-name').value,
      domain: document.getElementById('nat64-domain').value,
      uuid: document.getElementById('nat64-uuid').value,
      prefix: document.getElementById('nat64-prefix').value
    };
    
    if (!config.uuid) {
      generateUUID('nat64-uuid');
      config.uuid = document.getElementById('nat64-uuid').value;
    }
    
    const sourceNode = `vless://${config.uuid}@${config.domain}:443?encryption=none&security=tls&type=ws&host=${config.domain}&path=%2F%3Fed%3D2560&sni=${config.domain}#NAT64_${config.name || 'Enhanced'}`;
    document.getElementById('nat64-result').value = sourceNode;
  }
  
  // ProxyIPæºèŠ‚ç‚¹ç”Ÿæˆ
  async function generateProxyIPNode() {
    const config = {
      name: document.getElementById('proxyip-name').value,
      domain: document.getElementById('proxyip-domain').value,
      uuid: document.getElementById('proxyip-uuid').value,
      proxyIP: document.getElementById('proxyip-address').value
    };
    
    if (!config.uuid) {
      generateUUID('proxyip-uuid');
      config.uuid = document.getElementById('proxyip-uuid').value;
    }
    
    const sourceNode = `vless://${config.uuid}@${config.domain}:443?encryption=none&security=tls&type=ws&host=${config.domain}&path=%2F%3Fed%3D2560&sni=${config.domain}#ProxyIP_${config.name || 'Enhanced'}`;
    document.getElementById('proxyip-result').value = sourceNode;
  }
  ```

**2. é…ç½®ä¿å­˜å’Œç®¡ç†**
- **ä¿å­˜é…ç½®åˆ°æ•°æ®åº“**ï¼š
  ```javascript
  // ä¿å­˜NAT64é…ç½®
  async function saveNAT64Config() {
    const config = {
      name: document.getElementById('nat64-name').value,
      domain: document.getElementById('nat64-domain').value,
      uuid: document.getElementById('nat64-uuid').value,
      prefix: document.getElementById('nat64-prefix').value,
      sourceNode: document.getElementById('nat64-result').value
    };
    
    const response = await fetch('/api/source-nodes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        config_name: config.name,
        node_type: 'nat64',
        config_data: JSON.stringify(config),
        generated_node: config.sourceNode
      })
    });
    
    if (response.ok) {
      alert('NAT64é…ç½®ä¿å­˜æˆåŠŸï¼');
      loadSavedConfigs();
    }
  }
  
  // ä¿å­˜ProxyIPé…ç½®
  async function saveProxyIPConfig() {
    const config = {
      name: document.getElementById('proxyip-name').value,
      domain: document.getElementById('proxyip-domain').value,
      uuid: document.getElementById('proxyip-uuid').value,
      proxyIP: document.getElementById('proxyip-address').value,
      sourceNode: document.getElementById('proxyip-result').value
    };
    
    const response = await fetch('/api/source-nodes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        config_name: config.name,
        node_type: 'proxyip',
        config_data: JSON.stringify(config),
        generated_node: config.sourceNode
      })
    });
    
    if (response.ok) {
      alert('ProxyIPé…ç½®ä¿å­˜æˆåŠŸï¼');
      loadSavedConfigs();
    }
  }
  ```

**3. ä¸ç°æœ‰èŠ‚ç‚¹ç”Ÿæˆå™¨çš„é›†æˆ**
- **ä¸€é”®å¯¼å…¥åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨**ï¼š
  ```javascript
  // å°†æºèŠ‚ç‚¹å¯¼å…¥åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨
  function importToNodeGenerator(sourceNode) {
    // åˆ‡æ¢åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨æ ‡ç­¾é¡µ
    document.getElementById('generator-tab').click();
    
    // å°†æºèŠ‚ç‚¹å¡«å…¥æ¨¡æ¿URLè¾“å…¥æ¡†
    document.getElementById('templateUrl').value = sourceNode;
    
    // è§¦å‘æ ¼å¼è‡ªåŠ¨è¯†åˆ«
    document.getElementById('templateUrl').dispatchEvent(new Event('input'));
    
    alert('æºèŠ‚ç‚¹å·²å¯¼å…¥åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨ï¼Œç°åœ¨å¯ä»¥æ‰©å±•ç”Ÿæˆæ›´å¤šèŠ‚ç‚¹ï¼');
  }
  ```

#### é˜¶æ®µå››ï¼šåç«¯APIæ‰©å±• (ä¼˜å…ˆçº§ï¼šé«˜)

**1. æºèŠ‚ç‚¹ç®¡ç†API**
- **ä¿å­˜æºèŠ‚ç‚¹é…ç½®**ï¼š
  ```javascript
  // åœ¨_worker.jsä¸­æ·»åŠ æ–°çš„APIè·¯ç”±
  case '/api/source-nodes':
    if (request.method === 'POST') {
      const user = await getUserBySession(request, env);
      if (!user) return new Response(JSON.stringify({ error: 'æœªæˆæƒ' }), { status: 401 });
      
      const { config_name, node_type, config_data, generated_node } = await request.json();
      
      const result = await env.DB.prepare(
        "INSERT INTO source_node_configs (user_id, config_name, node_type, config_data, generated_node) VALUES (?, ?, ?, ?, ?)"
      ).bind(user.id, config_name, node_type, config_data, generated_node).run();
      
      return new Response(JSON.stringify({ success: true, id: result.meta.last_row_id }));
    }
    break;
  ```

**2. è·å–å·²ä¿å­˜é…ç½®**ï¼š
  ```javascript
  case '/api/source-nodes':
    if (request.method === 'GET') {
      const user = await getUserBySession(request, env);
      if (!user) return new Response(JSON.stringify({ error: 'æœªæˆæƒ' }), { status: 401 });
      
      const configs = await env.DB.prepare(
        "SELECT * FROM source_node_configs WHERE user_id = ? ORDER BY created_at DESC"
      ).bind(user.id).all();
      
      return new Response(JSON.stringify(configs.results));
    }
    break;
  ```

### ğŸ—„ï¸ æ•°æ®åº“æ¶æ„æ‰©å±•

```sql
-- æºèŠ‚ç‚¹é…ç½®è¡¨ï¼ˆå·²åœ¨é˜¶æ®µä¸€å®šä¹‰ï¼Œè¿™é‡Œæ˜¯å®Œæ•´ç‰ˆæœ¬ï¼‰
CREATE TABLE source_node_configs (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,
    config_name TEXT NOT NULL,
    node_type TEXT NOT NULL, -- 'nat64' æˆ– 'proxyip'
    config_data TEXT NOT NULL, -- JSONæ ¼å¼çš„é…ç½®æ•°æ®
    generated_node TEXT NOT NULL, -- ç”Ÿæˆçš„æºèŠ‚ç‚¹é“¾æ¥
    enabled BOOLEAN DEFAULT true,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);

-- ä¸ºæºèŠ‚ç‚¹é…ç½®è¡¨åˆ›å»ºç´¢å¼•
CREATE INDEX idx_source_node_configs_user_id ON source_node_configs(user_id);
CREATE INDEX idx_source_node_configs_node_type ON source_node_configs(node_type);
```

### ğŸ”§ æŠ€æœ¯å®ç°æ¶æ„

#### 1. æ ¸å¿ƒå·¥ä½œæµç¨‹
```
ç”¨æˆ·é…ç½® â†’ æºèŠ‚ç‚¹ç”Ÿæˆ â†’ å¤åˆ¶åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨ â†’ æ‰©å±•ç”Ÿæˆå¤šèŠ‚ç‚¹ â†’ Tagç®¡ç†
    â†“           â†“              â†“                â†“              â†“
WebUIé…ç½®   NAT64/ProxyIP   ç°æœ‰ç”Ÿæˆå™¨åŠŸèƒ½    æ‰¹é‡èŠ‚ç‚¹ç”Ÿæˆ    ç°æœ‰Tagç³»ç»Ÿ
```

#### 2. æºèŠ‚ç‚¹ç”Ÿæˆé€»è¾‘
```javascript
// æ ¸å¿ƒç”Ÿæˆé€»è¾‘
function generateSourceNode(type, config) {
    const baseTemplate = `vless://${config.uuid}@${config.domain}:443?encryption=none&security=tls&type=ws&host=${config.domain}&path=%2F%3Fed%3D2560&sni=${config.domain}`;
    
    switch(type) {
        case 'nat64':
            return `${baseTemplate}#NAT64_${config.name}`;
        case 'proxyip':
            return `${baseTemplate}#ProxyIP_${config.name}`;
        default:
            return baseTemplate;
    }
}
```

#### 3. ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆç‚¹
```javascript
// é›†æˆç°æœ‰èŠ‚ç‚¹ç”Ÿæˆå™¨
function integrateWithExistingGenerator() {
    // 1. æºèŠ‚ç‚¹ â†’ æ¨¡æ¿URLè¾“å…¥æ¡†
    // 2. åˆ©ç”¨ç°æœ‰çš„åœ°å€æ± å’Œç«¯å£é…ç½®
    // 3. ä½¿ç”¨ç°æœ‰çš„æ ¼å¼è½¬æ¢åŠŸèƒ½
    // 4. è¾“å‡ºåˆ°ç°æœ‰çš„Tagç®¡ç†ç³»ç»Ÿ
}
```

### ğŸš€ å¼€å‘é‡Œç¨‹ç¢‘ - è¯¦ç»†ä»»åŠ¡åˆ†è§£

#### ğŸ“‹ é¡¹ç›®1: æ•°æ®åº“æ¶æ„æ‰©å±• (é¢„è®¡1-2å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] **1.1** æ‰©å±•usersè¡¨ï¼Œæ·»åŠ user_uuidå­—æ®µ
  ```sql
  ALTER TABLE users ADD COLUMN user_uuid TEXT UNIQUE;
  CREATE INDEX idx_users_uuid ON users(user_uuid);
  ```
- [ ] **1.2** åˆ›å»ºsource_node_configsè¡¨
  ```sql
  CREATE TABLE source_node_configs (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,
    config_name TEXT NOT NULL,
    node_type TEXT NOT NULL, -- 'nat64' æˆ– 'proxyip'
    config_data TEXT NOT NULL, -- JSONæ ¼å¼é…ç½®
    generated_node TEXT NOT NULL, -- ç”Ÿæˆçš„æºèŠ‚ç‚¹é“¾æ¥
    is_default BOOLEAN DEFAULT false,
    enabled BOOLEAN DEFAULT true,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
  );
  ```
- [ ] **1.3** åˆ›å»ºç›¸å…³ç´¢å¼•
  ```sql
  CREATE INDEX idx_source_node_configs_user_id ON source_node_configs(user_id);
  CREATE INDEX idx_source_node_configs_node_type ON source_node_configs(node_type);
  ```
- [ ] **1.4** æµ‹è¯•æ•°æ®åº“è¿ç§»è„šæœ¬

#### ğŸ“‹ é¡¹ç›®2: ç”¨æˆ·æ³¨å†Œé€»è¾‘æ‰©å±• (é¢„è®¡2-3å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] **2.1** ä¿®æ”¹ç”¨æˆ·æ³¨å†ŒAPIï¼Œè‡ªåŠ¨åˆ†é…UUID
  ```javascript
  // åœ¨æ³¨å†Œæ—¶ç”Ÿæˆç”¨æˆ·ä¸“å±UUID
  const userUUID = crypto.randomUUID();
  ```
- [ ] **2.2** å®ç°é»˜è®¤NAT64æºèŠ‚ç‚¹åˆ›å»ºå‡½æ•°
  ```javascript
  async function createDefaultNAT64Config(userId, userUUID, env)
  ```
- [ ] **2.3** å®ç°é»˜è®¤ProxyIPæºèŠ‚ç‚¹åˆ›å»ºå‡½æ•°
  ```javascript
  async function createDefaultProxyIPConfig(userId, userUUID, env)
  ```
- [ ] **2.4** é›†æˆåˆ°ç°æœ‰æ³¨å†Œæµç¨‹
- [ ] **2.5** å¤„ç†ç°æœ‰ç”¨æˆ·çš„UUIDåˆ†é…ï¼ˆæ•°æ®è¿ç§»ï¼‰
- [ ] **2.6** æµ‹è¯•æ³¨å†Œæµç¨‹å’Œé»˜è®¤èŠ‚ç‚¹åˆ›å»º

#### ğŸ“‹ é¡¹ç›®3: NAT64æ ¸å¿ƒé€»è¾‘é›†æˆ (é¢„è®¡3-4å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] **3.1** ä»_workernat64.jsæå–NAT64æ ¸å¿ƒå‡½æ•°
  - [ ] `convertToNAT64IPv6()` å‡½æ•°
  - [ ] `getIPv6ProxyAddress()` å‡½æ•°
  - [ ] NAT64é‡è¯•æœºåˆ¶
- [ ] **3.2** é›†æˆåˆ°ç°æœ‰_worker.jsä¸­
  - [ ] æ·»åŠ NAT64å¤„ç†è·¯ç”±
  - [ ] é›†æˆWebSocketå¤„ç†é€»è¾‘
- [ ] **3.3** å®ç°NAT64é…ç½®éªŒè¯
- [ ] **3.4** æ·»åŠ NAT64ç›¸å…³çš„ç¯å¢ƒå˜é‡æ”¯æŒ
- [ ] **3.5** æµ‹è¯•NAT64åŠŸèƒ½

#### ğŸ“‹ é¡¹ç›®4: ProxyIPæ ¸å¿ƒé€»è¾‘é›†æˆ (é¢„è®¡3-4å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] **4.1** ä»vlessnoproxyip.jsæå–ProxyIPæ ¸å¿ƒå‡½æ•°
  - [ ] ProxyIPè§£æé€»è¾‘
  - [ ] è¿æ¥é‡è¯•æœºåˆ¶
  - [ ] IPv4/IPv6åœ°å€å¤„ç†
- [ ] **4.2** é›†æˆåˆ°ç°æœ‰_worker.jsä¸­
  - [ ] æ·»åŠ ProxyIPå¤„ç†è·¯ç”±
  - [ ] é›†æˆè¿æ¥å¤„ç†é€»è¾‘
- [ ] **4.3** å®ç°ProxyIPé…ç½®éªŒè¯
- [ ] **4.4** æ”¯æŒåŠ¨æ€ProxyIPé…ç½®
- [ ] **4.5** æµ‹è¯•ProxyIPåŠŸèƒ½

#### ğŸ“‹ é¡¹ç›®5: WebUIç•Œé¢æ‰©å±• (é¢„è®¡4-5å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] **5.1** æ·»åŠ æºèŠ‚ç‚¹ç®¡ç†æ ‡ç­¾é¡µ
  ```html
  <li class="nav-item">
    <button class="nav-link" id="source-nodes-tab">ğŸ”§ æºèŠ‚ç‚¹ç®¡ç†</button>
  </li>
  ```
- [ ] **5.2** åˆ›å»ºNAT64é…ç½®é¢æ¿
  - [ ] é…ç½®åç§°è¾“å…¥
  - [ ] WorkeråŸŸåé…ç½®
  - [ ] UUIDæ˜¾ç¤ºå’Œç”Ÿæˆ
  - [ ] NAT64å‰ç¼€é…ç½®
- [ ] **5.3** åˆ›å»ºProxyIPé…ç½®é¢æ¿
  - [ ] é…ç½®åç§°è¾“å…¥
  - [ ] WorkeråŸŸåé…ç½®
  - [ ] UUIDæ˜¾ç¤ºå’Œç”Ÿæˆ
  - [ ] ProxyIPåœ°å€é…ç½®
- [ ] **5.4** å®ç°é»˜è®¤æºèŠ‚ç‚¹æ˜¾ç¤º
- [ ] **5.5** æ·»åŠ é…ç½®ä¿å­˜å’Œç®¡ç†åŠŸèƒ½
- [ ] **5.6** å®ç°ä¸€é”®å¤åˆ¶å’Œå¯¼å…¥åŠŸèƒ½

#### ğŸ“‹ é¡¹ç›®6: åç«¯APIæ‰©å±• (é¢„è®¡2-3å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] **6.1** å®ç°æºèŠ‚ç‚¹é…ç½®ä¿å­˜API
  ```javascript
  POST /api/source-nodes
  ```
- [ ] **6.2** å®ç°æºèŠ‚ç‚¹é…ç½®è·å–API
  ```javascript
  GET /api/source-nodes
  ```
- [ ] **6.3** å®ç°æºèŠ‚ç‚¹é…ç½®æ›´æ–°API
  ```javascript
  PUT /api/source-nodes/:id
  ```
- [ ] **6.4** å®ç°æºèŠ‚ç‚¹é…ç½®åˆ é™¤API
  ```javascript
  DELETE /api/source-nodes/:id
  ```
- [ ] **6.5** æ·»åŠ æƒé™éªŒè¯å’Œç”¨æˆ·ç»‘å®šæ£€æŸ¥
- [ ] **6.6** å®ç°é…ç½®é‡ç½®åŠŸèƒ½

#### ğŸ“‹ é¡¹ç›®7: å‰ç«¯JavaScriptåŠŸèƒ½ (é¢„è®¡3-4å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] **7.1** å®ç°UUIDç”Ÿæˆå‡½æ•°
  ```javascript
  function generateUUID(inputId)
  ```
- [ ] **7.2** å®ç°NAT64æºèŠ‚ç‚¹ç”Ÿæˆå‡½æ•°
  ```javascript
  async function generateNAT64Node()
  ```
- [ ] **7.3** å®ç°ProxyIPæºèŠ‚ç‚¹ç”Ÿæˆå‡½æ•°
  ```javascript
  async function generateProxyIPNode()
  ```
- [ ] **7.4** å®ç°é…ç½®ä¿å­˜å‡½æ•°
  ```javascript
  async function saveNAT64Config()
  async function saveProxyIPConfig()
  ```
- [ ] **7.5** å®ç°é…ç½®åŠ è½½å’Œæ˜¾ç¤ºå‡½æ•°
- [ ] **7.6** å®ç°ä¸€é”®å¯¼å…¥åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨åŠŸèƒ½
- [ ] **7.7** æ·»åŠ è¡¨å•éªŒè¯å’Œé”™è¯¯å¤„ç†

#### ğŸ“‹ é¡¹ç›®8: ç³»ç»Ÿé›†æˆå’Œæµ‹è¯• (é¢„è®¡2-3å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] **8.1** é›†æˆæµ‹è¯•æ‰€æœ‰æ–°åŠŸèƒ½
- [ ] **8.2** æµ‹è¯•ä¸ç°æœ‰èŠ‚ç‚¹ç”Ÿæˆå™¨çš„å…¼å®¹æ€§
- [ ] **8.3** æµ‹è¯•ä¸ç°æœ‰Tagç®¡ç†çš„é›†æˆ
- [ ] **8.4** æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- [ ] **8.5** é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] **8.6** ç”¨æˆ·ä½“éªŒæµ‹è¯•å’Œä¼˜åŒ–

#### ğŸ“‹ é¡¹ç›®9: æ–‡æ¡£å’Œéƒ¨ç½² (é¢„è®¡1-2å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] **9.1** æ›´æ–°ç”¨æˆ·ä½¿ç”¨è¯´æ˜
- [ ] **9.2** æ·»åŠ æºèŠ‚ç‚¹ç®¡ç†çš„å¸®åŠ©æ–‡æ¡£
- [ ] **9.3** æ›´æ–°APIæ–‡æ¡£
- [ ] **9.4** åˆ›å»ºéƒ¨ç½²å’Œé…ç½®æŒ‡å—
- [ ] **9.5** æœ€ç»ˆæµ‹è¯•å’Œéƒ¨ç½²

### ğŸ“Š æ€»ä½“æ—¶é—´ä¼°ç®—

| é¡¹ç›® | é¢„è®¡æ—¶é—´ | ä¾èµ–å…³ç³» |
|------|----------|----------|
| é¡¹ç›®1: æ•°æ®åº“æ‰©å±• | 1-2å¤© | æ—  |
| é¡¹ç›®2: ç”¨æˆ·æ³¨å†Œæ‰©å±• | 2-3å¤© | ä¾èµ–é¡¹ç›®1 |
| é¡¹ç›®3: NAT64é›†æˆ | 3-4å¤© | ä¾èµ–é¡¹ç›®1 |
| é¡¹ç›®4: ProxyIPé›†æˆ | 3-4å¤© | ä¾èµ–é¡¹ç›®1 |
| é¡¹ç›®5: WebUIæ‰©å±• | 4-5å¤© | ä¾èµ–é¡¹ç›®2 |
| é¡¹ç›®6: APIæ‰©å±• | 2-3å¤© | ä¾èµ–é¡¹ç›®1,2 |
| é¡¹ç›®7: å‰ç«¯åŠŸèƒ½ | 3-4å¤© | ä¾èµ–é¡¹ç›®5,6 |
| é¡¹ç›®8: é›†æˆæµ‹è¯• | 2-3å¤© | ä¾èµ–æ‰€æœ‰å‰é¢é¡¹ç›® |
| é¡¹ç›®9: æ–‡æ¡£éƒ¨ç½² | 1-2å¤© | ä¾èµ–é¡¹ç›®8 |

**æ€»è®¡ï¼š21-30å¤© (çº¦3-4å‘¨)**

### ğŸ¯ å»ºè®®çš„å¼€å‘é¡ºåº

**ç¬¬ä¸€å‘¨ï¼šåŸºç¡€æ¶æ„**
- é¡¹ç›®1: æ•°æ®åº“æ‰©å±•
- é¡¹ç›®2: ç”¨æˆ·æ³¨å†Œæ‰©å±•
- é¡¹ç›®3: NAT64é›†æˆ

**ç¬¬äºŒå‘¨ï¼šæ ¸å¿ƒåŠŸèƒ½**
- é¡¹ç›®4: ProxyIPé›†æˆ
- é¡¹ç›®5: WebUIæ‰©å±•

**ç¬¬ä¸‰å‘¨ï¼šåŠŸèƒ½å®Œå–„**
- é¡¹ç›®6: APIæ‰©å±•
- é¡¹ç›®7: å‰ç«¯åŠŸèƒ½

**ç¬¬å››å‘¨ï¼šæµ‹è¯•éƒ¨ç½²**
- é¡¹ç›®8: é›†æˆæµ‹è¯•
- é¡¹ç›®9: æ–‡æ¡£éƒ¨ç½²

### ğŸ’¡ æ ¸å¿ƒä»·å€¼å’Œåˆ›æ–°ç‚¹

#### 1. **å®Œç¾çš„åŠŸèƒ½é—­ç¯**
```
æºèŠ‚ç‚¹é…ç½® â†’ æºèŠ‚ç‚¹ç”Ÿæˆ â†’ èŠ‚ç‚¹æ‰©å±• â†’ Tagç®¡ç† â†’ è®¢é˜…è¾“å‡º
     â†‘                                              â†“
   WebUIé…ç½® â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â† å®Œæ•´çš„ç®¡ç†æµç¨‹
```

#### 2. **æŠ€æœ¯åˆ›æ–°ç‚¹**
- **é¦–ä¸ªé›†æˆNAT64å’ŒProxyIPçš„è®¢é˜…ç®¡ç†å¹³å°**
- **æºèŠ‚ç‚¹ + èŠ‚ç‚¹ç”Ÿæˆå™¨çš„åŒé‡æ‰©å±•èƒ½åŠ›**
- **åŸºäºç°æœ‰æ¶æ„çš„æ— ç¼é›†æˆ**
- **é€‚é…Cloudflare Workers/Pagesçš„è½»é‡åŒ–è®¾è®¡**

#### 3. **ç”¨æˆ·ä»·å€¼**
- **ç®€åŒ–é…ç½®**ï¼šé€šè¿‡WebUIè½»æ¾é…ç½®NAT64å’ŒProxyIP
- **æ‰©å±•èƒ½åŠ›**ï¼šä¸€ä¸ªæºèŠ‚ç‚¹å¯ä»¥æ‰©å±•å‡ºæ•°ç™¾ä¸ªèŠ‚ç‚¹
- **ç®¡ç†ä¾¿æ·**ï¼šä¸ç°æœ‰Tagç³»ç»Ÿå®Œç¾é›†æˆ
- **å³æ’å³ç”¨**ï¼šç”Ÿæˆçš„æºèŠ‚ç‚¹å¯ç›´æ¥ç”¨äºèŠ‚ç‚¹ç”Ÿæˆå™¨

### ğŸ¯ å®æ–½å»ºè®®

#### ç«‹å³å¼€å§‹çš„ç¬¬ä¸€æ­¥ï¼š
1. **æ‰©å±•æ•°æ®åº“**ï¼šæ·»åŠ æºèŠ‚ç‚¹é…ç½®è¡¨
2. **åˆ›å»ºWebUIç•Œé¢**ï¼šåœ¨ç°æœ‰ç•Œé¢ä¸­æ·»åŠ æ–°æ ‡ç­¾é¡µ
3. **å®ç°åŸºç¡€ç”ŸæˆåŠŸèƒ½**ï¼šNAT64å’ŒProxyIPæºèŠ‚ç‚¹ç”Ÿæˆ

#### æ ¸å¿ƒä¼˜åŠ¿ï¼š
- **åŸºäºç°æœ‰æ¶æ„**ï¼šæœ€å°åŒ–å¼€å‘æˆæœ¬
- **å……åˆ†åˆ©ç”¨ç°æœ‰åŠŸèƒ½**ï¼šèŠ‚ç‚¹ç”Ÿæˆå™¨ã€Tagç®¡ç†ã€è®¢é˜…è¾“å‡º
- **ç¬¦åˆCloudflareé™åˆ¶**ï¼šè½»é‡åŒ–ã€é«˜æ•ˆçš„å®ç°æ–¹æ¡ˆ
- **ç”¨æˆ·å‹å¥½**ï¼šç®€å•çš„é…ç½®ç•Œé¢ï¼Œå¼ºå¤§çš„æ‰©å±•èƒ½åŠ›

è¿™ä¸ªæ–¹æ¡ˆå®Œç¾å¥‘åˆä½ çš„æ„æ€ï¼š**é€šè¿‡WebUIé…ç½®ç”ŸæˆNAT64å’ŒProxyIPæºèŠ‚ç‚¹ï¼Œç„¶ååˆ©ç”¨ç°æœ‰çš„èŠ‚ç‚¹ç”Ÿæˆå™¨æ‰©å±•å‡ºæ›´å¤šèŠ‚ç‚¹ï¼Œå½¢æˆå®Œæ•´çš„èŠ‚ç‚¹ç”Ÿæˆå’Œç®¡ç†é—­ç¯**ï¼ğŸ¯

---

## ğŸ” UUIDç®¡ç†å’Œå®‰å…¨æœºåˆ¶ä¼˜åŒ–

### ğŸ“‹ ç”¨æˆ·ç†è§£ç¡®è®¤

ä½ çš„é€»è¾‘å®Œå…¨æ­£ç¡®ï¼è®©æˆ‘ç¡®è®¤ä¸€ä¸‹æ ¸å¿ƒè¦ç‚¹ï¼š

#### 1. **UUIDç®¡ç†ç­–ç•¥**
- **ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ†é…UUID**ï¼šæ¯ä¸ªç”¨æˆ·è´¦å·å¯¹åº”ä¸€ä¸ªå”¯ä¸€UUID
- **æ›¿ä»£ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼šä¸å†ä½¿ç”¨"UUID + Pages URL"çš„å…¬å¼€è®¿é—®æ–¹å¼
- **å®‰å…¨æ€§æå‡**ï¼šUUIDä¸ç”¨æˆ·è´¦å·ç»‘å®šï¼Œé˜²æ­¢æ‰«æå’Œæ»¥ç”¨
- **WebUIç®¡ç†**ï¼šé€šè¿‡ç™»å½•åçš„ç•Œé¢è¿›è¡ŒèŠ‚ç‚¹ç”Ÿæˆå’Œç®¡ç†

#### 2. **é»˜è®¤æºèŠ‚ç‚¹æœºåˆ¶**
- **è‡ªåŠ¨åˆ›å»º**ï¼šç”¨æˆ·æ³¨å†Œæ—¶é»˜è®¤åˆ›å»ºNAT64å’ŒProxyIPä¸¤ä¸ªæºèŠ‚ç‚¹
- **åŸºç¡€èŠ‚ç‚¹**ï¼šè¿™ä¸¤ä¸ªæºèŠ‚ç‚¹ä½œä¸ºç”¨æˆ·çš„åŸºç¡€ä»£ç†èŠ‚ç‚¹
- **æ‰©å±•èƒ½åŠ›**ï¼šç”¨æˆ·å¯ä»¥åŸºäºè¿™ä¸¤ä¸ªæºèŠ‚ç‚¹ç”Ÿæˆæ›´å¤šèŠ‚ç‚¹
- **ä¿æŒå…¼å®¹**ï¼šåŸæœ‰çš„å¯¼å…¥è®¢é˜…åŠŸèƒ½ç»§ç»­ä¿æŒ

### ğŸ”§ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

#### 1. **ç”¨æˆ·æ³¨å†Œæ—¶çš„UUIDåˆ†é…**
```javascript
// åœ¨ç”¨æˆ·æ³¨å†ŒAPIä¸­
async function registerUser(username, password, env) {
    // ç”Ÿæˆç”¨æˆ·ä¸“å±UUID
    const userUUID = crypto.randomUUID();
    
    // åˆ›å»ºç”¨æˆ·è´¦å·
    const userResult = await env.DB.prepare(
        "INSERT INTO users (username, password_hash, user_uuid) VALUES (?, ?, ?)"
    ).bind(username, hashedPassword, userUUID).run();
    
    const userId = userResult.meta.last_row_id;
    
    // è‡ªåŠ¨åˆ›å»ºé»˜è®¤çš„NAT64æºèŠ‚ç‚¹é…ç½®
    await createDefaultNAT64Config(userId, userUUID, env);
    
    // è‡ªåŠ¨åˆ›å»ºé»˜è®¤çš„ProxyIPæºèŠ‚ç‚¹é…ç½®
    await createDefaultProxyIPConfig(userId, userUUID, env);
    
    return { userId, userUUID };
}
```

#### 2. **é»˜è®¤æºèŠ‚ç‚¹åˆ›å»º**
```javascript
// åˆ›å»ºé»˜è®¤NAT64æºèŠ‚ç‚¹
async function createDefaultNAT64Config(userId, userUUID, env) {
    const defaultDomain = 'your-worker.workers.dev'; // æˆ–ä»ç¯å¢ƒå˜é‡è·å–
    const nat64Config = {
        name: 'Default NAT64',
        domain: defaultDomain,
        uuid: userUUID,
        prefix: '2602:fc59:b0:64::'
    };
    
    const sourceNode = `vless://${userUUID}@${defaultDomain}:443?encryption=none&security=tls&type=ws&host=${defaultDomain}&path=%2F%3Fed%3D2560&sni=${defaultDomain}#NAT64_Default`;
    
    await env.DB.prepare(
        "INSERT INTO source_node_configs (user_id, config_name, node_type, config_data, generated_node, is_default) VALUES (?, ?, ?, ?, ?, ?)"
    ).bind(userId, 'Default NAT64', 'nat64', JSON.stringify(nat64Config), sourceNode, true).run();
}

// åˆ›å»ºé»˜è®¤ProxyIPæºèŠ‚ç‚¹
async function createDefaultProxyIPConfig(userId, userUUID, env) {
    const defaultDomain = 'your-worker.workers.dev';
    const proxyIPConfig = {
        name: 'Default ProxyIP',
        domain: defaultDomain,
        uuid: userUUID,
        proxyIP: '' // ç”¨æˆ·å¯ä»¥åç»­é…ç½®
    };
    
    const sourceNode = `vless://${userUUID}@${defaultDomain}:443?encryption=none&security=tls&type=ws&host=${defaultDomain}&path=%2F%3Fed%3D2560&sni=${defaultDomain}#ProxyIP_Default`;
    
    await env.DB.prepare(
        "INSERT INTO source_node_configs (user_id, config_name, node_type, config_data, generated_node, is_default) VALUES (?, ?, ?, ?, ?, ?)"
    ).bind(userId, 'Default ProxyIP', 'proxyip', JSON.stringify(proxyIPConfig), sourceNode, true).run();
}
```

#### 3. **æ•°æ®åº“æ¶æ„æ‰©å±•**
```sql
-- æ‰©å±•usersè¡¨ï¼Œæ·»åŠ user_uuidå­—æ®µ
ALTER TABLE users ADD COLUMN user_uuid TEXT UNIQUE;

-- æ‰©å±•source_node_configsè¡¨ï¼Œæ·»åŠ é»˜è®¤èŠ‚ç‚¹æ ‡è¯†
ALTER TABLE source_node_configs ADD COLUMN is_default BOOLEAN DEFAULT false;

-- åˆ›å»ºUUIDç´¢å¼•
CREATE INDEX idx_users_uuid ON users(user_uuid);
```

#### 4. **WebUIæ˜¾ç¤ºé»˜è®¤æºèŠ‚ç‚¹**
```javascript
// åŠ è½½ç”¨æˆ·çš„æºèŠ‚ç‚¹é…ç½®
async function loadUserSourceNodes() {
    const response = await fetch('/api/source-nodes');
    const configs = await response.json();
    
    // åˆ†ç¦»é»˜è®¤èŠ‚ç‚¹å’Œè‡ªå®šä¹‰èŠ‚ç‚¹
    const defaultNodes = configs.filter(config => config.is_default);
    const customNodes = configs.filter(config => !config.is_default);
    
    // åœ¨ç•Œé¢ä¸Šæ˜¾ç¤º
    displayDefaultNodes(defaultNodes);
    displayCustomNodes(customNodes);
}

// æ˜¾ç¤ºé»˜è®¤æºèŠ‚ç‚¹
function displayDefaultNodes(defaultNodes) {
    const container = document.getElementById('default-source-nodes');
    container.innerHTML = `
        <h4>ğŸ”§ é»˜è®¤æºèŠ‚ç‚¹</h4>
        <div class="alert alert-info">
            <small>è¿™äº›æ˜¯ç³»ç»Ÿä¸ºæ‚¨è‡ªåŠ¨åˆ›å»ºçš„åŸºç¡€æºèŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ–åŸºäºå®ƒä»¬æ‰©å±•æ›´å¤šèŠ‚ç‚¹ã€‚</small>
        </div>
    `;
    
    defaultNodes.forEach(node => {
        container.innerHTML += `
            <div class="card mb-2">
                <div class="card-body">
                    <h6>${node.config_name} (${node.node_type.toUpperCase()})</h6>
                    <div class="input-group">
                        <input type="text" class="form-control" value="${node.generated_node}" readonly>
                        <button class="btn btn-outline-primary" onclick="copyToClipboard('${node.generated_node}')">ğŸ“‹</button>
                        <button class="btn btn-outline-success" onclick="importToNodeGenerator('${node.generated_node}')">ğŸš€ å¯¼å…¥ç”Ÿæˆå™¨</button>
                    </div>
                </div>
            </div>
        `;
    });
}
```

### ğŸ”’ å®‰å…¨æ€§æå‡

#### 1. **UUIDç»‘å®šéªŒè¯**
```javascript
// åœ¨Workerä¸­éªŒè¯UUIDä¸ç”¨æˆ·çš„ç»‘å®šå…³ç³»
async function validateUserUUID(request, env) {
    const url = new URL(request.url);
    const pathUUID = extractUUIDFromPath(url.pathname);
    
    if (pathUUID) {
        // éªŒè¯UUIDæ˜¯å¦å±äºå½“å‰ç”¨æˆ·
        const user = await getUserBySession(request, env);
        if (!user || user.user_uuid !== pathUUID) {
            return new Response('Unauthorized', { status: 401 });
        }
    }
    
    return null; // éªŒè¯é€šè¿‡
}
```

#### 2. **é˜²æ‰«ææœºåˆ¶**
- UUIDä¸ç”¨æˆ·è´¦å·ç»‘å®šï¼Œæ— æ³•é€šè¿‡æ‰«æè·å–
- éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®èŠ‚ç‚¹ç”ŸæˆåŠŸèƒ½
- å¯ä»¥æ·»åŠ è®¿é—®é¢‘ç‡é™åˆ¶

### ğŸ¯ ç”¨æˆ·ä½“éªŒæµç¨‹

#### 1. **æ–°ç”¨æˆ·æ³¨å†Œæµç¨‹**
```
ç”¨æˆ·æ³¨å†Œ â†’ è‡ªåŠ¨åˆ†é…UUID â†’ åˆ›å»ºé»˜è®¤æºèŠ‚ç‚¹ â†’ ç™»å½•åå³å¯ä½¿ç”¨
```

#### 2. **æ—¥å¸¸ä½¿ç”¨æµç¨‹**
```
ç™»å½• â†’ æŸ¥çœ‹é»˜è®¤æºèŠ‚ç‚¹ â†’ å¤åˆ¶æˆ–å¯¼å…¥åˆ°ç”Ÿæˆå™¨ â†’ æ‰©å±•ç”Ÿæˆæ›´å¤šèŠ‚ç‚¹ â†’ Tagç®¡ç†
```

#### 3. **é«˜çº§ç”¨æˆ·æµç¨‹**
```
ç™»å½• â†’ è‡ªå®šä¹‰ProxyIPé…ç½® â†’ åˆ›å»ºæ–°æºèŠ‚ç‚¹ â†’ å¤šæºèŠ‚ç‚¹ç®¡ç† â†’ æ‰¹é‡èŠ‚ç‚¹ç”Ÿæˆ
```

### â“ éœ€è¦ç¡®è®¤çš„ç»†èŠ‚

1. **åŸŸåé…ç½®**ï¼šé»˜è®¤æºèŠ‚ç‚¹ä½¿ç”¨å“ªä¸ªåŸŸåï¼Ÿæ˜¯å›ºå®šçš„WorkeråŸŸåè¿˜æ˜¯ç”¨æˆ·å¯é…ç½®ï¼Ÿ

2. **ProxyIPé»˜è®¤å€¼**ï¼šé»˜è®¤ProxyIPæºèŠ‚ç‚¹æ˜¯å¦ç•™ç©ºï¼Œè®©ç”¨æˆ·è‡ªå·±é…ç½®ï¼Ÿè¿˜æ˜¯æä¾›ä¸€äº›é»˜è®¤çš„ä¼˜é€‰IPï¼Ÿ

3. **èŠ‚ç‚¹å‘½å**ï¼šé»˜è®¤æºèŠ‚ç‚¹çš„å‘½åè§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦éœ€è¦åŒ…å«ç”¨æˆ·æ ‡è¯†ï¼Ÿ

4. **æ›´æ–°æœºåˆ¶**ï¼šç”¨æˆ·æ˜¯å¦å¯ä»¥ä¿®æ”¹é»˜è®¤æºèŠ‚ç‚¹çš„é…ç½®ï¼Ÿè¿˜æ˜¯åªèƒ½åˆ›å»ºæ–°çš„è‡ªå®šä¹‰æºèŠ‚ç‚¹ï¼Ÿ

ä½ çš„ç†è§£å’Œæˆ‘çš„åˆ†ææ˜¯å¦ä¸€è‡´ï¼Ÿæœ‰æ²¡æœ‰éœ€è¦è°ƒæ•´æˆ–è¡¥å……çš„åœ°æ–¹ï¼ŸğŸ¤”