# ğŸ“‹ NAT64 VLESS ä»£ç†é¡¹ç›®æŠ€æœ¯åˆ†æç¬”è®°

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº Cloudflare Workers çš„ NAT64 VLESS ä»£ç†é¡¹ç›®ï¼Œä¸“é—¨è®¾è®¡ç”¨äºåœ¨ IPv6 ç¯å¢ƒä¸‹é€šè¿‡ NAT64 æŠ€æœ¯è®¿é—® IPv4 èµ„æºï¼Œå¹¶æä¾›å¤šç§å®¢æˆ·ç«¯è®¢é˜…æ ¼å¼ã€‚

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æ¶æ„

### 1. NAT64 æŠ€æœ¯å®ç°

**æ ¸å¿ƒåŸç†ï¼š**

- NAT64 æ˜¯ä¸€ç§ IPv6 åˆ° IPv4 çš„è½¬æ¢æŠ€æœ¯
- å½“ç›´è¿ IPv4 å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨é€šè¿‡ NAT64 IPv6 åœ°å€é‡è¯•è¿æ¥
- ä½¿ç”¨å›ºå®šçš„ NAT64 å‰ç¼€ï¼š`2602:fc59:b0:64::`

**å…³é”®ä»£ç é€»è¾‘ï¼š**

```javascript
// NAT64 IPv6åœ°å€è½¬æ¢å‡½æ•° (ç¬¬249-265è¡Œ)
function convertToNAT64IPv6(ipv4Address) {
  const parts = ipv4Address.split(".");
  const hex = parts.map((part) => {
    const num = parseInt(part, 10);
    return num.toString(16).padStart(2, "0");
  });
  const prefixes = ["2602:fc59:b0:64::"];
  const chosenPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];
  return `[${chosenPrefix}${hex[0]}${hex[1]}:${hex[2]}${hex[3]}]`;
}
```

**DNS è§£æä¸ NAT64 è½¬æ¢æµç¨‹ï¼š**

```javascript
// è·å–IPv6ä»£ç†åœ°å€ (ç¬¬267-287è¡Œ)
async function getIPv6ProxyAddress(domain) {
  // 1. é€šè¿‡Cloudflare DoHæŸ¥è¯¢Aè®°å½•
  const dnsQuery = await fetch(
    `https://1.1.1.1/dns-query?name=${domain}&type=A`
  );
  // 2. æå–IPv4åœ°å€
  const ipv4Address = aRecord.data;
  // 3. è½¬æ¢ä¸ºNAT64 IPv6åœ°å€
  return convertToNAT64IPv6(ipv4Address);
}
```

### 2. VLESS åè®®å¤„ç†

**åè®®è§£æï¼š**

```javascript
// VLESSå¤´éƒ¨è§£æ (ç¬¬369-435è¡Œ)
function parseVlessHeader(buffer, userID) {
  // éªŒè¯ç‰ˆæœ¬å·ã€UUIDã€é€‰é¡¹é•¿åº¦
  // è§£æå‘½ä»¤ç±»å‹ï¼ˆTCP=1, UDP=2ï¼‰
  // è§£æç›®æ ‡åœ°å€ï¼ˆIPv4/åŸŸå/IPv6ï¼‰å’Œç«¯å£
  // è¿”å›è§£æç»“æœ
}
```

**è¿æ¥é‡è¯•æœºåˆ¶ï¼š**

```javascript
// è¿æ¥å¤±è´¥æ—¶çš„NAT64é‡è¯• (ç¬¬289-315è¡Œ)
async function retry() {
  const proxyIP = await getIPv6ProxyAddress(result.addressRemote);
  console.log(`å°è¯•é€šè¿‡NAT64 IPv6åœ°å€ ${proxyIP} è¿æ¥...`);
  const tcpSocket = await connect({
    hostname: proxyIP,
    port: result.portRemote,
  });
}
```

### 3. é¢„å®šä¹‰ IP å’Œç«¯å£é…ç½®

**IP åœ°å€æ± ï¼š**

- HTTP IP æ± ï¼š7 ä¸ª Visa åŸŸåï¼ˆIP1-IP7ï¼‰
- HTTPS IP æ± ï¼š6 ä¸ª Visa åŸŸåï¼ˆIP8-IP13ï¼‰
- æ‰€æœ‰ IP éƒ½ç»è¿‡ Unicode ç¼–ç æ··æ·†

**ç«¯å£é…ç½®ï¼š**

- HTTP ç«¯å£ï¼š80, 8080, 8880, 2052, 2082, 2086, 2095
- HTTPS ç«¯å£ï¼š443, 8443, 2053, 2083, 2087, 2096

## ğŸŒ è®¢é˜…ç”Ÿæˆç³»ç»Ÿ

### 1. è·¯ç”±ç»“æ„

```javascript
// ä¸»è¦è®¢é˜…è·¯å¾„
/${userID}        // ä¸»é¡µé¢ï¼Œæ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯
/${userID}/ty     // é€šç”¨è®¢é˜…ï¼ˆBase64ç¼–ç ï¼‰
/${userID}/cl     // Clashè®¢é˜…
/${userID}/sb     // Sing-boxè®¢é˜…
/${userID}/pty    // Pagesä¸“ç”¨é€šç”¨è®¢é˜…
/${userID}/pcl    // Pagesä¸“ç”¨Clashè®¢é˜…
/${userID}/psb    // Pagesä¸“ç”¨Sing-boxè®¢é˜…
```

### 2. èŠ‚ç‚¹ç”Ÿæˆé€»è¾‘

**Workers åŸŸåèŠ‚ç‚¹ï¼š**

- åŒ…å« HTTP + HTTPS å…± 13 ä¸ªç«¯å£çš„èŠ‚ç‚¹
- æ”¯æŒ TLS å’Œé TLS ä¸¤ç§æ¨¡å¼

**Pages/è‡ªå®šä¹‰åŸŸåèŠ‚ç‚¹ï¼š**

- ä»…åŒ…å« HTTPS çš„ 6 ä¸ªç«¯å£èŠ‚ç‚¹
- å¼ºåˆ¶å¯ç”¨ TLS åŠ å¯†

### 3. è®¢é˜…æ ¼å¼è¯¦è§£

**é€šç”¨è®¢é˜…æ ¼å¼ï¼ˆBase64ï¼‰ï¼š**

```javascript
// ç”ŸæˆVLESSé“¾æ¥å¹¶Base64ç¼–ç 
const vlessLink = `vless://${userID}@${IP}:${PORT}?encryption=none&security=tls&type=ws&host=${hostName}&path=%2F%3Fed%3D2560#CF_V${index}_${IP}_${PORT}`;
const subscription = btoa(vlessLinks.join("\n"));
```

**Clash è®¢é˜…æ ¼å¼ï¼š**

```yaml
# åŒ…å«å®Œæ•´çš„Clashé…ç½®
proxies:
  - name: CF_V1_${IP1}_${PT1}
    type: vless
    server: ${IP1}
    port: ${PT1}
    uuid: ${userID}
    network: ws
    ws-opts:
      path: "/?ed=2560"
      headers:
        Host: ${hostName}
```

**Sing-box è®¢é˜…æ ¼å¼ï¼š**

```json
{
  "outbounds": [
    {
      "server": "${IP}",
      "server_port": ${PORT},
      "tag": "CF_V${index}_${IP}_${PORT}",
      "type": "vless",
      "uuid": "${userID}",
      "transport": {
        "type": "ws",
        "path": "/?ed=2560",
        "headers": {"Host": ["${hostName}"]}
      }
    }
  ]
}
```

## ğŸ”„ æ•°æ®æµå¤„ç†

### 1. WebSocket å¤„ç†æµç¨‹

```javascript
// WebSocketæ•°æ®æµ (ç¬¬190-340è¡Œ)
1. æ¥æ”¶WebSocketè¿æ¥
2. è§£æVLESSåè®®å¤´éƒ¨
3. å°è¯•ç›´è¿ç›®æ ‡åœ°å€
4. è¿æ¥å¤±è´¥æ—¶å¯åŠ¨NAT64é‡è¯•
5. å»ºç«‹æ•°æ®è½¬å‘ç®¡é“
```

### 2. UDP DNS å¤„ç†

```javascript
// DNSæŸ¥è¯¢å¤„ç† (ç¬¬491-546è¡Œ)
if (result.portRemote === 53) {
  isDns = true;
  // è½¬å‘DNSæŸ¥è¯¢åˆ°1.1.1.1
  const resp = await fetch("https://1.1.1.1/dns-query", {
    method: "POST",
    headers: { "content-type": "application/dns-message" },
    body: chunk,
  });
}
```

## ğŸ¨ å‰ç«¯ç•Œé¢ç‰¹æ€§

### 1. Bootstrap å“åº”å¼è®¾è®¡

- ä½¿ç”¨ Bootstrap 5.3.3 æ¡†æ¶
- å“åº”å¼è¡¨æ ¼å’ŒæŒ‰é’®å¸ƒå±€
- ä¸€é”®å¤åˆ¶åŠŸèƒ½

### 2. èŠ‚ç‚¹å±•ç¤ºé€»è¾‘

- æ ¹æ®åŸŸåç±»å‹æ˜¾ç¤ºä¸åŒèŠ‚ç‚¹é›†åˆ
- Workers åŸŸåï¼šæ˜¾ç¤º HTTP+HTTPS èŠ‚ç‚¹
- è‡ªå®šä¹‰åŸŸåï¼šä»…æ˜¾ç¤º HTTPS èŠ‚ç‚¹

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### 1. UUID éªŒè¯

```javascript
// ä¸¥æ ¼çš„UUIDéªŒè¯
if (uuid !== userID) {
  return { hasError: true, message: "æ— æ•ˆçš„ç”¨æˆ·" };
}
```

### 2. åè®®é™åˆ¶

- ä»…æ”¯æŒ TCP å’Œ UDPï¼ˆç«¯å£ 53 DNSï¼‰
- å…¶ä»– UDP æµé‡è¢«æ‹’ç»

### 3. TLS é…ç½®

- æ”¯æŒ TLS/é TLS åŒæ¨¡å¼
- åŒ…å« SNI å’ŒæŒ‡çº¹ä¼ªè£…

## ğŸš€ éƒ¨ç½²é…ç½®

### 1. ç¯å¢ƒå˜é‡æ”¯æŒ

```javascript
// æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è‡ªå®šä¹‰æ‰€æœ‰IPå’Œç«¯å£
userID = env.uuid || userID;
IP1 = env.ip1 || IP1;
PT1 = env.pt1 || PT1;
// ... æ”¯æŒ13ä¸ªIPå’Œ13ä¸ªç«¯å£çš„è‡ªå®šä¹‰
```

### 2. åå‘ä»£ç†åŠŸèƒ½

- æ”¯æŒéšæœºåŸŸååå‘ä»£ç†
- åŒ…å«è¯·æ±‚å¤´ä¼ªè£…
- é˜²æ­¢é‡å®šå‘æ”»å‡»

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

1. **è‡ªåŠ¨æ•…éšœè½¬ç§»**ï¼šIPv4 è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° NAT64 IPv6
2. **å¤šæ ¼å¼æ”¯æŒ**ï¼šåŒæ—¶æ”¯æŒé€šç”¨ã€Clashã€Sing-box ä¸‰ç§è®¢é˜…æ ¼å¼
3. **çµæ´»é…ç½®**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡æ”¯æŒå®Œå…¨è‡ªå®šä¹‰ IP å’Œç«¯å£
4. **æ™ºèƒ½è·¯ç”±**ï¼šæ ¹æ®åŸŸåç±»å‹è‡ªåŠ¨é€‰æ‹©èŠ‚ç‚¹é›†åˆ
5. **å®‰å…¨åŠ å›º**ï¼šåŒ…å«å¤šå±‚éªŒè¯å’Œåè®®é™åˆ¶

## ğŸ”® é€‚ç”¨åœºæ™¯

- **IPv6 ä¼˜å…ˆç½‘ç»œ**ï¼šåœ¨ IPv6 ç¯å¢ƒä¸‹è®¿é—® IPv4 èµ„æº
- **æ•™è‚²ç½‘ç¯å¢ƒ**ï¼šåˆ©ç”¨æ•™è‚²ç½‘ IPv6 å…æµç‰¹æ€§
- **ç§»åŠ¨ç½‘ç»œ**ï¼šæŸäº›ç§»åŠ¨è¿è¥å•†çš„ IPv6 ç½‘ç»œç¯å¢ƒ
- **Cloudflare ä¼˜åŒ–**ï¼šå……åˆ†åˆ©ç”¨ CF çš„å…¨çƒç½‘ç»œ

## ğŸ“ å¼€å‘è¦ç‚¹æ€»ç»“

### å…³é”®æŠ€æœ¯æ ˆ

- **Cloudflare Workers**ï¼šæ— æœåŠ¡å™¨è®¡ç®—å¹³å°
- **NAT64**ï¼šIPv6 åˆ° IPv4 åœ°å€è½¬æ¢æŠ€æœ¯
- **VLESS åè®®**ï¼šè½»é‡çº§ä»£ç†åè®®
- **WebSocket**ï¼šå®æ—¶åŒå‘é€šä¿¡
- **DNS over HTTPS**ï¼šå®‰å…¨ DNS æŸ¥è¯¢

### æ ¸å¿ƒç®—æ³•

1. **IPv4 åˆ° NAT64 IPv6 è½¬æ¢ç®—æ³•**
2. **VLESS åè®®è§£æç®—æ³•**
3. **è‡ªåŠ¨é‡è¯•æœºåˆ¶**
4. **å¤šæ ¼å¼è®¢é˜…ç”Ÿæˆç®—æ³•**

### æ€§èƒ½ä¼˜åŒ–

- è¿æ¥æ± å¤ç”¨
- å¼‚æ­¥å¹¶å‘å¤„ç†
- æ™ºèƒ½æ•…éšœè½¬ç§»
- ç¼“å­˜æœºåˆ¶

è¿™ä¸ªé¡¹ç›®å·§å¦™åœ°ç»“åˆäº† NAT64 æŠ€æœ¯å’Œ VLESS åè®®ï¼Œä¸º IPv6 ç¯å¢ƒä¸‹çš„ä»£ç†è®¿é—®æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸš¨ éƒ¨ç½²å¤±è´¥é—®é¢˜åˆ†æä¸ä¿®å¤ç»éªŒæ€»ç»“

### ğŸ“‹ é—®é¢˜èƒŒæ™¯

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŸå§‹ `_worker.js` æ–‡ä»¶åœ¨ Cloudflare Pages éƒ¨ç½²æ—¶å‡ºç°"æ— å¯ç”¨éƒ¨ç½²"é”™è¯¯ï¼Œç»è¿‡æ·±å…¥åˆ†æå’Œé€æ­¥æ’æŸ¥ï¼Œæœ€ç»ˆæ‰¾åˆ°å¹¶ä¿®å¤äº†æ ¹æœ¬åŸå› ã€‚

### ğŸ” é—®é¢˜åˆ†æè¿‡ç¨‹

#### 1. **åˆæ­¥æ’æŸ¥**

- æ£€æŸ¥ Cloudflare Pages éƒ¨ç½²æ—¥å¿—
- éªŒè¯æ–‡ä»¶ç»“æ„å’Œè¯­æ³•
- ç¡®è®¤ç¯å¢ƒå˜é‡å’Œç»‘å®šé…ç½®

#### 2. **é€æ­¥æµ‹è¯•**

- åˆ›å»ºç®€åŒ–ç‰ˆæœ¬éªŒè¯åŸºæœ¬åŠŸèƒ½
- é€æ­¥æ·»åŠ åŠŸèƒ½æ¨¡å—
- å¯¹æ¯”æˆåŠŸå’Œå¤±è´¥çš„ç‰ˆæœ¬å·®å¼‚

#### 3. **æ ¹æœ¬åŸå› å‘ç°**

é€šè¿‡ä»£ç åˆ†æå‘ç°åŸå§‹æ–‡ä»¶ä¸­å­˜åœ¨**é‡å¤å‡½æ•°å®šä¹‰**ï¼Œè¿™æ˜¯å¯¼è‡´ JavaScript è§£æé”™è¯¯çš„ä¸»è¦åŸå› ã€‚

### ğŸš¨ é—®é¢˜æ ¹æº

#### **é‡å¤å‡½æ•°å®šä¹‰é”™è¯¯**

åŸå§‹ `_worker.js` æ–‡ä»¶ä¸­å­˜åœ¨å¤šä¸ªé‡å¤çš„å‡½æ•°å®šä¹‰ï¼š

```javascript
// é—®é¢˜ï¼šä»¥ä¸‹å‡½æ•°è¢«å®šä¹‰äº†ä¸¤æ¬¡
function convertToNAT64IPv6(ipv4Address) { ... }  // ç¬¬581è¡Œ
function convertToNAT64IPv6(ipv4Address) { ... }  // ç¬¬652è¡Œ - é‡å¤ï¼

function getIPv6ProxyAddress(domain) { ... }      // ç¬¬607è¡Œ
function getIPv6ProxyAddress(domain) { ... }      // ç¬¬678è¡Œ - é‡å¤ï¼

function isIPv4(address) { ... }                  // ç¬¬437è¡Œ
function isIPv4(address) { ... }                  // ç¬¬633è¡Œ - é‡å¤ï¼
```

#### **é”™è¯¯å½±å“**

- JavaScript è§£æå™¨æ— æ³•å¤„ç†é‡å¤çš„å‡½æ•°å®šä¹‰
- å¯¼è‡´æ•´ä¸ªæ–‡ä»¶è§£æå¤±è´¥
- Cloudflare Pages éƒ¨ç½²æ—¶è¿”å›"æ— å¯ç”¨éƒ¨ç½²"é”™è¯¯

### ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

#### 1. **åˆ é™¤é‡å¤å‡½æ•°å®šä¹‰**

```javascript
// ä¿®å¤å‰ï¼šé‡å¤å®šä¹‰å¯¼è‡´è§£æé”™è¯¯
function convertToNAT64IPv6(ipv4Address) { ... }
function convertToNAT64IPv6(ipv4Address) { ... }  // åˆ é™¤è¿™è¡Œ

// ä¿®å¤åï¼šåªä¿ç•™ä¸€ä¸ªå®šä¹‰
function convertToNAT64IPv6(ipv4Address) { ... }
```

#### 2. **ä¿æŒåŠŸèƒ½å®Œæ•´æ€§**

- åˆ é™¤é‡å¤å®šä¹‰ï¼Œä¿ç•™ç¬¬ä¸€ä¸ªå®šä¹‰
- ç¡®ä¿æ‰€æœ‰åŠŸèƒ½é€»è¾‘å®Œæ•´
- éªŒè¯ä¿®å¤åçš„ä»£ç è¯­æ³•æ­£ç¡®

#### 3. **æ–‡ä»¶ä¼˜åŒ–**

- æ–‡ä»¶å¤§å°ï¼šä» 2955 è¡Œå‡å°‘åˆ° 2901 è¡Œ
- ç§»é™¤äº† 54 è¡Œé‡å¤ä»£ç 
- ä¿æŒäº†æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ä¸å˜

### ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

| é¡¹ç›®           | ä¿®å¤å‰              | ä¿®å¤å       |
| -------------- | ------------------- | ------------ |
| **æ–‡ä»¶è¡Œæ•°**   | 2955 è¡Œ             | 2901 è¡Œ      |
| **é‡å¤å‡½æ•°**   | 3 ä¸ªå‡½æ•°å„é‡å¤ 2 æ¬¡ | æ— é‡å¤       |
| **éƒ¨ç½²çŠ¶æ€**   | å¤±è´¥ï¼ˆæ— å¯ç”¨éƒ¨ç½²ï¼‰  | æˆåŠŸ         |
| **åŠŸèƒ½å®Œæ•´æ€§** | ä»£ç æ— æ³•è§£æ        | æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ |

### ğŸ’¡ ç»éªŒæ•™è®­

#### 1. **ä»£ç å®¡æŸ¥é‡è¦æ€§**

- åœ¨é›†æˆå¤šä¸ªåŠŸèƒ½æ¨¡å—æ—¶ï¼Œå®¹æ˜“å‡ºç°é‡å¤å®šä¹‰
- éœ€è¦ä»”ç»†æ£€æŸ¥å‡½æ•°åå’Œå˜é‡åçš„å”¯ä¸€æ€§
- å»ºè®®ä½¿ç”¨ä»£ç æ£€æŸ¥å·¥å…·é¿å…æ­¤ç±»é—®é¢˜

#### 2. **é€æ­¥æµ‹è¯•ç­–ç•¥**

- ä»ç®€åŒ–ç‰ˆæœ¬å¼€å§‹ï¼Œé€æ­¥æ·»åŠ åŠŸèƒ½
- æ¯ä¸ªæ­¥éª¤éƒ½è¦éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸ
- åŠæ—¶å‘ç°é—®é¢˜ï¼Œé¿å…é—®é¢˜ç´¯ç§¯

#### 3. **é”™è¯¯æ’æŸ¥æ–¹æ³•**

- å¯¹æ¯”æˆåŠŸå’Œå¤±è´¥çš„ç‰ˆæœ¬
- ä½¿ç”¨ grep æœç´¢é‡å¤å®šä¹‰
- æ£€æŸ¥ JavaScript è¯­æ³•é”™è¯¯

#### 4. **Cloudflare Pages ç‰¹æ€§**

- Pages å¯¹ JavaScript è¯­æ³•è¦æ±‚ä¸¥æ ¼
- é‡å¤å®šä¹‰ä¼šå¯¼è‡´æ•´ä¸ªæ–‡ä»¶è§£æå¤±è´¥
- é”™è¯¯ä¿¡æ¯å¯èƒ½ä¸å¤Ÿæ˜ç¡®ï¼Œéœ€è¦æ·±å…¥æ’æŸ¥

### ğŸ”§ é¢„é˜²æªæ–½

#### 1. **å¼€å‘è§„èŒƒ**

```javascript
// å»ºè®®ï¼šåœ¨å‡½æ•°å®šä¹‰å‰æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
if (typeof functionName === 'undefined') {
    function functionName() { ... }
}

// æˆ–è€…ä½¿ç”¨æ¨¡å—åŒ–æ–¹å¼é¿å…é‡å¤å®šä¹‰
const utils = {
    convertToNAT64IPv6: function(ipv4Address) { ... },
    getIPv6ProxyAddress: function(domain) { ... },
    isIPv4: function(address) { ... }
};
```

#### 2. **ä»£ç æ£€æŸ¥å·¥å…·**

- ä½¿ç”¨ ESLint æ£€æŸ¥é‡å¤å®šä¹‰
- é…ç½® IDE çš„è¯­æ³•æ£€æŸ¥
- å®šæœŸè¿›è¡Œä»£ç å®¡æŸ¥

#### 3. **æµ‹è¯•ç­–ç•¥**

- æ¯æ¬¡é‡å¤§ä¿®æ”¹åéƒ½è¦æµ‹è¯•éƒ¨ç½²
- ä¿æŒç®€åŒ–ç‰ˆæœ¬ä½œä¸ºå¤‡ä»½
- å»ºç«‹å®Œæ•´çš„æµ‹è¯•æµç¨‹

### ğŸ¯ æˆåŠŸä¿®å¤ç»“æœ

ä¿®å¤åçš„ `_worker.js` æ–‡ä»¶ï¼š

- âœ… **éƒ¨ç½²æˆåŠŸ**ï¼šCloudflare Pages æ­£å¸¸éƒ¨ç½²
- âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ‰€æœ‰ VLESSã€NAT64ã€ç”¨æˆ·ç®¡ç†åŠŸèƒ½æ­£å¸¸
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘äº†é‡å¤ä»£ç ï¼Œæé«˜äº†æ‰§è¡Œæ•ˆç‡
- âœ… **ä»£ç è´¨é‡**ï¼šæ¶ˆé™¤äº†è¯­æ³•é”™è¯¯ï¼Œæé«˜äº†ä»£ç å¯ç»´æŠ¤æ€§

### ğŸ“ æ€»ç»“

è¿™æ¬¡éƒ¨ç½²å¤±è´¥çš„é—®é¢˜è™½ç„¶çœ‹ä¼¼ç®€å•ï¼Œä½†æ’æŸ¥è¿‡ç¨‹å¾ˆæœ‰ä»·å€¼ã€‚**é‡å¤å‡½æ•°å®šä¹‰**æ˜¯ JavaScript å¼€å‘ä¸­çš„å¸¸è§é”™è¯¯ï¼Œç‰¹åˆ«æ˜¯åœ¨é›†æˆå¤šä¸ªåŠŸèƒ½æ¨¡å—æ—¶å®¹æ˜“å‘ç”Ÿã€‚é€šè¿‡è¿™æ¬¡ç»éªŒï¼Œæˆ‘ä»¬å»ºç«‹äº†æ›´å¥½çš„ä»£ç å®¡æŸ¥å’Œæµ‹è¯•æµç¨‹ï¼Œç¡®ä¿ç±»ä¼¼é—®é¢˜ä¸å†å‘ç”Ÿã€‚

å…³é”®ç»éªŒï¼š

1. **é—®é¢˜æ’æŸ¥è¦ç³»ç»ŸåŒ–**ï¼šä»ç®€å•åˆ°å¤æ‚ï¼Œé€æ­¥éªŒè¯
2. **ä»£ç é›†æˆè¦è°¨æ…**ï¼šé¿å…é‡å¤å®šä¹‰å’Œå‘½åå†²çª
3. **æµ‹è¯•éªŒè¯è¦åŠæ—¶**ï¼šæ¯æ¬¡ä¿®æ”¹åéƒ½è¦éªŒè¯éƒ¨ç½²
4. **é”™è¯¯ä¿¡æ¯è¦æ·±å…¥åˆ†æ**ï¼šè¡¨é¢é”™è¯¯å¯èƒ½æ©ç›–æ ¹æœ¬åŸå› 

è¿™ä¸ªä¿®å¤ç»éªŒä¸ºåç»­å¼€å‘æä¾›äº†é‡è¦çš„å‚è€ƒï¼Œç¡®ä¿é¡¹ç›®çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

---

## ğŸ”„ ProxyIP ç‰ˆæœ¬å¯¹æ¯”åˆ†æ (vlessnoproxyip.js)

### ğŸ“‹ ç‰ˆæœ¬å·®å¼‚æ¦‚è¿°

`vlessnoproxyip.js` æ˜¯ `_workernat64.js` çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä¸»è¦å·®å¼‚ï¼š

**ç§»é™¤çš„åŠŸèƒ½ï¼š**

- âŒ NAT64 è‡ªåŠ¨è½¬æ¢æœºåˆ¶
- âŒ IPv6 æ•…éšœè½¬ç§»é€»è¾‘
- âŒ DNS over HTTPS æŸ¥è¯¢

**ä¿ç•™çš„åŠŸèƒ½ï¼š**

- âœ… è‡ªå®šä¹‰ ProxyIP æ”¯æŒ
- âœ… å¤šæ ¼å¼è®¢é˜…ç”Ÿæˆ
- âœ… VLESS åè®®å¤„ç†
- âœ… ç¯å¢ƒå˜é‡é…ç½®

### ğŸ¯ ProxyIP æ ¸å¿ƒå®ç°

#### 1. ProxyIP é…ç½®æœºåˆ¶

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**

```javascript
// ç¬¬8è¡Œï¼šProxyIPæ•°ç»„å®šä¹‰
const proxyIPs = [""];

// ç¬¬45-46è¡Œï¼šéšæœºé€‰æ‹©å’Œç«¯å£è§£æ
let proxyIP = proxyIPs[Math.floor(Math.random() * proxyIPs.length)];
let proxyPort = proxyIP.match(/:(\d+)$/) ? proxyIP.match(/:(\d+)$/)[1] : "443";
```

**ç¯å¢ƒå˜é‡è¦†ç›–é€»è¾‘ (ç¬¬ 61-88 è¡Œ)ï¼š**

```javascript
const { proxyip } = env;
if (proxyip) {
  // IPv6åœ°å€æ ¼å¼å¤„ç†ï¼š[IPv6]:port
  if (proxyip.includes("]:")) {
    let lastColonIndex = proxyip.lastIndexOf(":");
    proxyPort = proxyip.slice(lastColonIndex + 1);
    proxyIP = proxyip.slice(0, lastColonIndex);
  }
  // IPv4åœ°å€æ ¼å¼å¤„ç†ï¼šIPv4:port
  else if (!proxyip.includes("]:") && !proxyip.includes("]")) {
    [proxyIP, proxyPort = "443"] = proxyip.split(":");
  }
  // çº¯IPv6åœ°å€ï¼šé»˜è®¤443ç«¯å£
  else {
    proxyPort = "443";
    proxyIP = proxyip;
  }
}
```

#### 2. åŠ¨æ€ ProxyIP è®¾ç½®

**URL è·¯å¾„å‚æ•°æ”¯æŒ (ç¬¬ 221-237 è¡Œ)ï¼š**

```javascript
// æ”¯æŒé€šè¿‡URLåŠ¨æ€è®¾ç½®ProxyIPï¼š/pyip=IP:PORT
if (url.pathname.includes("/pyip=")) {
  const tmp_ip = url.pathname.split("=")[1];
  if (isValidIP(tmp_ip)) {
    proxyIP = tmp_ip;
    // é‡æ–°è§£æIPå’Œç«¯å£
    if (proxyIP.includes("]:")) {
      let lastColonIndex = proxyIP.lastIndexOf(":");
      proxyPort = proxyIP.slice(lastColonIndex + 1);
      proxyIP = proxyIP.slice(0, lastColonIndex);
    } else if (!proxyIP.includes("]:") && !proxyIP.includes("]")) {
      [proxyIP, proxyPort = "443"] = proxyIP.split(":");
    } else {
      proxyPort = "443";
    }
  }
}
```

#### 3. ProxyIP è¿æ¥é€»è¾‘

**TCP è¿æ¥å¤„ç† (ç¬¬ 409-443 è¡Œ)ï¼š**

```javascript
async function handleTCPOutBound() {
  // ç›´è¿ç›®æ ‡åœ°å€
  const tcpSocket = await connectAndWrite(addressRemote, portRemote);

  // è¿æ¥å¤±è´¥æ—¶çš„ProxyIPé‡è¯•æœºåˆ¶
  async function retry() {
    // ä½¿ç”¨ProxyIPè¿›è¡Œé‡è¯•è¿æ¥
    const tcpSocket = await connectAndWrite(
      proxyIP || addressRemote, // ä¼˜å…ˆä½¿ç”¨ProxyIP
      proxyPort || portRemote // ä¼˜å…ˆä½¿ç”¨ProxyPort
    );
    // å»ºç«‹æ•°æ®è½¬å‘
    remoteSocketToWS(tcpSocket, webSocket, cloudflareResponseHeader, null, log);
  }
}
```

**å…³é”®ç‰¹æ€§ï¼š**

- **æ™ºèƒ½åœ°å€å¤„ç†**ï¼šè‡ªåŠ¨è¯†åˆ« IPv4/IPv6 æ ¼å¼
- **ç«¯å£è§£æ**ï¼šæ”¯æŒåœ°å€:ç«¯å£æ ¼å¼
- **æ•…éšœè½¬ç§»**ï¼šç›´è¿å¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨ ProxyIP
- **åŠ¨æ€é…ç½®**ï¼šæ”¯æŒ URL å‚æ•°å’Œç¯å¢ƒå˜é‡

#### 4. ä¸ NAT64 ç‰ˆæœ¬çš„å¯¹æ¯”

| ç‰¹æ€§           | NAT64 ç‰ˆæœ¬      | ProxyIP ç‰ˆæœ¬   |
| -------------- | --------------- | -------------- |
| **æ•…éšœè½¬ç§»**   | NAT64 IPv6 è½¬æ¢ | è‡ªå®šä¹‰ ProxyIP |
| **åœ°å€è§£æ**   | DNS over HTTPS  | ç›´æ¥ä½¿ç”¨é…ç½®   |
| **é€‚ç”¨åœºæ™¯**   | IPv6 ç¯å¢ƒ       | é€šç”¨ä»£ç†ç¯å¢ƒ   |
| **é…ç½®å¤æ‚åº¦** | è‡ªåŠ¨åŒ–          | æ‰‹åŠ¨é…ç½®       |
| **çµæ´»æ€§**     | å›ºå®š NAT64 å‰ç¼€ | å®Œå…¨è‡ªå®šä¹‰     |

### ğŸ’¡ ProxyIP ä½¿ç”¨åœºæ™¯

1. **CDN ä¼˜é€‰**ï¼šä½¿ç”¨ä¼˜é€‰çš„ CDN IP ä½œä¸º ProxyIP
2. **è´Ÿè½½å‡è¡¡**ï¼šé…ç½®å¤šä¸ª ProxyIP å®ç°è´Ÿè½½åˆ†æ‹…
3. **åœ°åŒºä¼˜åŒ–**ï¼šé’ˆå¯¹ä¸åŒåœ°åŒºé…ç½®æœ€ä¼˜ ProxyIP
4. **æ•…éšœæ¢å¤**ï¼šå½“ç›´è¿å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° ProxyIP

### ğŸ”§ é…ç½®ç¤ºä¾‹

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**

```bash
# IPv4 ProxyIP
proxyip=1.2.3.4:443

# IPv6 ProxyIP
proxyip=[2001:db8::1]:443

# åŸŸå ProxyIP
proxyip=proxy.example.com:8443
```

**URL åŠ¨æ€é…ç½®ï¼š**

```
https://worker.domain.com/pyip=1.2.3.4:443
```

è¿™ä¸ª ProxyIP ç‰ˆæœ¬ä¸ºä¸éœ€è¦ NAT64 åŠŸèƒ½ä½†éœ€è¦çµæ´»ä»£ç†é…ç½®çš„åœºæ™¯æä¾›äº†å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸ” NAT64 vs ProxyIP ä»£ç†æœºåˆ¶æ·±åº¦åˆ†æ

### ğŸŒ é—®é¢˜èƒŒæ™¯

ç”±äº Cloudflare çš„ CDN ç­–ç•¥ï¼Œé€šè¿‡ CF Workers éƒ¨ç½²çš„ VLESS èŠ‚ç‚¹æ— æ³•ç›´æ¥è®¿é—® Cloudflare è‡ªèº«çš„ CDN ç½‘ç«™ï¼ˆå¦‚ ChatGPTã€X.comã€cloudflare.com ç­‰ï¼‰ï¼Œå› æ­¤éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼ç»•è¿‡è¿™ä¸ªé™åˆ¶ã€‚

### ğŸ”„ NAT64 ç‰ˆæœ¬çš„ä»£ç†é€»è¾‘

#### ğŸ“¡ NAT64 å·¥ä½œåŸç†

**ç¬¬ 1 æ­¥ï¼šç›´è¿å°è¯•**

```javascript
// ç¬¬318è¡Œï¼šå…ˆå°è¯•ç›´è¿ç›®æ ‡åœ°å€
const tcpSocket = await connectAndWrite(
  result.addressRemote,
  result.portRemote
);
```

**ç¬¬ 2 æ­¥ï¼šå¤±è´¥æ—¶çš„ NAT64 è½¬æ¢**

```javascript
// ç¬¬289-315è¡Œï¼šNAT64é‡è¯•æœºåˆ¶
async function retry() {
  // 1. é€šè¿‡DNS over HTTPSæŸ¥è¯¢ç›®æ ‡åŸŸåçš„IPv4åœ°å€
  const dnsQuery = await fetch(
    `https://1.1.1.1/dns-query?name=${domain}&type=A`
  );

  // 2. å°†IPv4åœ°å€è½¬æ¢ä¸ºNAT64 IPv6åœ°å€
  const proxyIP = await getIPv6ProxyAddress(result.addressRemote);
  // ä¾‹å¦‚ï¼š1.2.3.4 â†’ [2602:fc59:b0:64::0102:0304]

  // 3. é€šè¿‡NAT64 IPv6åœ°å€å»ºç«‹TCPè¿æ¥
  const tcpSocket = await connect({
    hostname: proxyIP, // IPv6åœ°å€
    port: result.portRemote,
  });
}
```

**NAT64 åœ°å€è½¬æ¢ç®—æ³•ï¼š**

```javascript
// ç¬¬249-265è¡Œï¼šIPv4åˆ°NAT64 IPv6è½¬æ¢
function convertToNAT64IPv6(ipv4Address) {
  const parts = ipv4Address.split("."); // [1, 2, 3, 4]
  const hex = parts.map((part) =>
    parseInt(part, 10).toString(16).padStart(2, "0")
  );
  // ç»“æœï¼š[01, 02, 03, 04]

  const prefix = "2602:fc59:b0:64::";
  return `[${prefix}${hex[0]}${hex[1]}:${hex[2]}${hex[3]}]`;
  // æœ€ç»ˆï¼š[2602:fc59:b0:64::0102:0304]
}
```

**NAT64 ä»£ç†ç±»å‹ï¼šç½‘ç»œå±‚è½¬æ¢**

- **ä¸æ˜¯ä¼ ç»Ÿä»£ç†**ï¼šNAT64 æ˜¯ç½‘ç»œå±‚çš„åœ°å€è½¬æ¢æŠ€æœ¯
- **é€æ˜è½¬æ¢**ï¼šç›´æ¥å»ºç«‹ TCP è¿æ¥åˆ°è½¬æ¢åçš„ IPv6 åœ°å€
- **åè®®**ï¼šçº¯ TCP è¿æ¥ï¼Œæ— éœ€ HTTP/SOCKS ä»£ç†åè®®

### ğŸ¯ ProxyIP ç‰ˆæœ¬çš„ä»£ç†é€»è¾‘

#### ğŸ”— ProxyIP å·¥ä½œåŸç†

**ç¬¬ 1 æ­¥ï¼šç›´è¿å°è¯•**

```javascript
// ç¬¬438è¡Œï¼šå…ˆå°è¯•ç›´è¿ç›®æ ‡åœ°å€
const tcpSocket = await connectAndWrite(addressRemote, portRemote);
```

**ç¬¬ 2 æ­¥ï¼šå¤±è´¥æ—¶çš„ ProxyIP é‡è¯•**

```javascript
// ç¬¬425-436è¡Œï¼šProxyIPé‡è¯•æœºåˆ¶
async function retry() {
  // ç›´æ¥é€šè¿‡ProxyIPå»ºç«‹TCPè¿æ¥
  const tcpSocket = await connectAndWrite(
    proxyIP || addressRemote, // ä½¿ç”¨ProxyIPåœ°å€
    proxyPort || portRemote // ä½¿ç”¨ProxyIPç«¯å£
  );
}
```

**ProxyIP ä»£ç†ç±»å‹ï¼šTCP å±‚ä¸­è½¬**

- **ä¸æ˜¯ HTTP ä»£ç†**ï¼šä¸ä½¿ç”¨ HTTP CONNECT æ–¹æ³•
- **ä¸æ˜¯ SOCKS ä»£ç†**ï¼šä¸ä½¿ç”¨ SOCKS4/5 åè®®
- **çº¯ TCP ä¸­è½¬**ï¼šç›´æ¥å»ºç«‹ TCP è¿æ¥åˆ° ProxyIPï¼Œç„¶åé€æ˜è½¬å‘æ•°æ®

### ğŸ“Š ä»£ç†æœºåˆ¶è¯¦ç»†å¯¹æ¯”

| ç‰¹æ€§           | NAT64 ç‰ˆæœ¬               | ProxyIP ç‰ˆæœ¬           |
| -------------- | ------------------------ | ---------------------- |
| **ä»£ç†åè®®**   | æ— ï¼ˆç½‘ç»œå±‚è½¬æ¢ï¼‰         | æ— ï¼ˆTCP å±‚ä¸­è½¬ï¼‰       |
| **å·¥ä½œå±‚çº§**   | ç½‘ç»œå±‚ï¼ˆIPv6/IPv4 è½¬æ¢ï¼‰ | ä¼ è¾“å±‚ï¼ˆTCP è½¬å‘ï¼‰     |
| **åœ°å€è§£æ**   | DNS over HTTPS è‡ªåŠ¨æŸ¥è¯¢  | ç›´æ¥ä½¿ç”¨é…ç½®çš„ IP/åŸŸå |
| **è¿æ¥æ–¹å¼**   | TCP â†’ NAT64 IPv6 åœ°å€    | TCP â†’ ProxyIP åœ°å€     |
| **é…ç½®å¤æ‚åº¦** | è‡ªåŠ¨åŒ–ï¼ˆæ— éœ€é…ç½®ï¼‰       | æ‰‹åŠ¨é…ç½® ProxyIP       |
| **é€‚ç”¨ç¯å¢ƒ**   | IPv6 ç½‘ç»œç¯å¢ƒ            | ä»»ä½•ç½‘ç»œç¯å¢ƒ           |
| **æ•…éšœè½¬ç§»**   | è‡ªåŠ¨ IPv4â†’IPv6 è½¬æ¢      | æ‰‹åŠ¨æŒ‡å®šä¸­è½¬èŠ‚ç‚¹       |

### ğŸ”§ å®é™…æ•°æ®æµå‘

#### NAT64 æ•°æ®æµï¼š

```
å®¢æˆ·ç«¯ â†’ CF Workers â†’ NAT64ç½‘å…³ â†’ ç›®æ ‡æœåŠ¡å™¨
       (VLESS/WS)   (IPv6â†’IPv4è½¬æ¢)  (åŸå§‹IPv4)
```

#### ProxyIP æ•°æ®æµï¼š

```
å®¢æˆ·ç«¯ â†’ CF Workers â†’ ProxyIPæœåŠ¡å™¨ â†’ ç›®æ ‡æœåŠ¡å™¨
       (VLESS/WS)   (TCPä¸­è½¬)        (TCPè½¬å‘)
```

### ğŸ’¡ å…³é”®æŠ€æœ¯ç»†èŠ‚

#### NAT64 æœºåˆ¶ï¼š

- **æœ¬è´¨**ï¼šåˆ©ç”¨ NAT64 ç½‘å…³è¿›è¡Œ IPv6 åˆ° IPv4 çš„ç½‘ç»œå±‚è½¬æ¢
- **ä¼˜åŠ¿**ï¼šå®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€é¢å¤–é…ç½®
- **é™åˆ¶**ï¼šä¾èµ– NAT64 åŸºç¡€è®¾æ–½
- **NAT64 å‰ç¼€**ï¼š`2602:fc59:b0:64::`ï¼ˆå›ºå®šï¼‰

#### ProxyIP æœºåˆ¶ï¼š

- **æœ¬è´¨**ï¼šä½¿ç”¨æŒ‡å®šçš„ IP/åŸŸåä½œä¸º TCP å±‚ä¸­è½¬èŠ‚ç‚¹
- **ä¼˜åŠ¿**ï¼šçµæ´»é…ç½®ï¼Œå¯ä½¿ç”¨ä»»ä½•å¯è¾¾çš„æœåŠ¡å™¨
- **é™åˆ¶**ï¼šéœ€è¦æ‰‹åŠ¨é…ç½®å¯ç”¨çš„ä¸­è½¬èŠ‚ç‚¹
- **æ”¯æŒæ ¼å¼**ï¼šIPv4ã€IPv6ã€åŸŸåï¼ˆå¸¦ç«¯å£æˆ–é»˜è®¤ 443ï¼‰

#### å…±åŒç‰¹ç‚¹ï¼š

- **éƒ½ä¸æ˜¯ä¼ ç»Ÿçš„ HTTP/SOCKS ä»£ç†**
- **éƒ½æ˜¯ TCP å±‚çš„é€æ˜è½¬å‘**
- **éƒ½ä¸éœ€è¦ç›®æ ‡æœåŠ¡å™¨æ”¯æŒç‰¹å®šä»£ç†åè®®**
- **æ•°æ®ä¼ è¾“å®Œå…¨é€æ˜ï¼Œç›®æ ‡æœåŠ¡å™¨çœ‹åˆ°çš„æ˜¯ä¸­è½¬èŠ‚ç‚¹çš„ IP**
- **éƒ½èƒ½æœ‰æ•ˆç»•è¿‡ Cloudflare CDN é™åˆ¶**

### ğŸ¯ ä½¿ç”¨åœºæ™¯é€‰æ‹©

**é€‰æ‹© NAT64 ç‰ˆæœ¬çš„æƒ…å†µï¼š**

- IPv6 ç½‘ç»œç¯å¢ƒ
- å¸Œæœ›å®Œå…¨è‡ªåŠ¨åŒ–çš„è§£å†³æ–¹æ¡ˆ
- ä¸æƒ³æ‰‹åŠ¨ç»´æŠ¤ ProxyIP åˆ—è¡¨
- æ•™è‚²ç½‘æˆ–æ”¯æŒ NAT64 çš„ç½‘ç»œ

**é€‰æ‹© ProxyIP ç‰ˆæœ¬çš„æƒ…å†µï¼š**

- ä»»ä½•ç½‘ç»œç¯å¢ƒ
- æœ‰å¯ç”¨çš„ä¸­è½¬æœåŠ¡å™¨èµ„æº
- éœ€è¦ç²¾ç¡®æ§åˆ¶ä»£ç†è·¯å¾„
- å¸Œæœ›ä½¿ç”¨ç‰¹å®šçš„ä¼˜é€‰ IP

è¿™ä¸¤ç§æ–¹æ¡ˆéƒ½å·§å¦™åœ°ç»•è¿‡äº† Cloudflare çš„ CDN é™åˆ¶ï¼Œä¸º VLESS èŠ‚ç‚¹è®¿é—® CF è‡ªèº«æœåŠ¡æä¾›äº†æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼

---

## ğŸš€ é¡¹ç›®åŠŸèƒ½æ‰©å±•å¼€å‘æ–¹æ¡ˆ (åŸºäº Cloudflare Workers/Pages)

### ğŸ“‹ äº§å“æ„¿æ™¯

åœ¨ç°æœ‰è®¢é˜…èšåˆç®¡ç†å¹³å°çš„åŸºç¡€ä¸Šï¼Œé›†æˆ NAT64 å’Œ ProxyIP æºèŠ‚ç‚¹ç”ŸæˆåŠŸèƒ½ï¼Œé€šè¿‡ WebUI é…ç½®ç”Ÿæˆè¿™ä¸¤ç§ç±»å‹çš„æºèŠ‚ç‚¹ï¼Œç„¶ååˆ©ç”¨ç°æœ‰çš„èŠ‚ç‚¹ç”Ÿæˆå™¨æ‰©å±•å‡ºæ›´å¤šèŠ‚ç‚¹ï¼Œå½¢æˆå®Œæ•´çš„èŠ‚ç‚¹ç”Ÿæˆå’Œç®¡ç†é—­ç¯ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ‰©å±•è§„åˆ’

#### é˜¶æ®µä¸€ï¼šæºèŠ‚ç‚¹ç”Ÿæˆå™¨ (ä¼˜å…ˆçº§ï¼šé«˜)

**1. NAT64 æºèŠ‚ç‚¹ç”Ÿæˆ**

- **åŠŸèƒ½æè¿°**ï¼šåŸºäºç°æœ‰\_workernat64.js ä»£ç ï¼Œç”Ÿæˆ NAT64 ç±»å‹çš„ VLESS æºèŠ‚ç‚¹
- **æŠ€æœ¯å®ç°**ï¼š

  ```javascript
  // åœ¨ç°æœ‰_worker.jsä¸­æ·»åŠ NAT64æºèŠ‚ç‚¹ç”Ÿæˆ
  function generateNAT64SourceNode(userConfig) {
    const nat64Config = {
      userID: userConfig.uuid || crypto.randomUUID(),
      hostName: userConfig.domain || "your-worker.workers.dev",
      nat64Prefix: userConfig.nat64Prefix || "2602:fc59:b0:64::",
      enableAutoFallback: userConfig.autoFallback !== false,
    };

    // ç”ŸæˆNAT64å¢å¼ºçš„VLESSèŠ‚ç‚¹
    return `vless://${nat64Config.userID}@${nat64Config.hostName}:443?encryption=none&security=tls&type=ws&host=${nat64Config.hostName}&path=%2F%3Fed%3D2560&sni=${nat64Config.hostName}#NAT64_Enhanced_${nat64Config.hostName}`;
  }
  ```

**2. ProxyIP æºèŠ‚ç‚¹ç”Ÿæˆ**

- **åŠŸèƒ½æè¿°**ï¼šåŸºäºç°æœ‰ vlessnoproxyip.js ä»£ç ï¼Œç”Ÿæˆ ProxyIP ç±»å‹çš„ VLESS æºèŠ‚ç‚¹
- **æŠ€æœ¯å®ç°**ï¼š

  ```javascript
  // ProxyIPæºèŠ‚ç‚¹ç”Ÿæˆ
  function generateProxyIPSourceNode(userConfig) {
    const proxyConfig = {
      userID: userConfig.uuid || crypto.randomUUID(),
      hostName: userConfig.domain || "your-worker.workers.dev",
      proxyIP: userConfig.proxyIP || "",
      proxyPort: userConfig.proxyPort || "443",
    };

    // ç”ŸæˆProxyIPå¢å¼ºçš„VLESSèŠ‚ç‚¹
    return `vless://${proxyConfig.userID}@${proxyConfig.hostName}:443?encryption=none&security=tls&type=ws&host=${proxyConfig.hostName}&path=%2F%3Fed%3D2560&sni=${proxyConfig.hostName}#ProxyIP_Enhanced_${proxyConfig.hostName}`;
  }
  ```

**3. æ•°æ®åº“æ‰©å±•**

- **æºèŠ‚ç‚¹é…ç½®è¡¨**ï¼š
  ```sql
  -- æºèŠ‚ç‚¹é…ç½®è¡¨
  CREATE TABLE source_node_configs (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,
    config_name TEXT,
    node_type TEXT, -- 'nat64' æˆ– 'proxyip'
    config_data TEXT, -- JSONæ ¼å¼çš„é…ç½®æ•°æ®
    generated_node TEXT, -- ç”Ÿæˆçš„æºèŠ‚ç‚¹é“¾æ¥
    enabled BOOLEAN DEFAULT true,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
  );
  ```

#### é˜¶æ®µäºŒï¼šWebUI æºèŠ‚ç‚¹é…ç½®ç•Œé¢ (ä¼˜å…ˆçº§ï¼šé«˜)

**1. æºèŠ‚ç‚¹é…ç½®ç®¡ç†é¡µé¢**

- **åœ¨ç°æœ‰ WebUI ä¸­æ–°å¢"æºèŠ‚ç‚¹ç®¡ç†"æ ‡ç­¾é¡µ**ï¼š
  ```html
  <!-- åœ¨ç°æœ‰å¯¼èˆªä¸­æ·»åŠ  -->
  <li class="nav-item">
    <button
      class="nav-link"
      id="source-nodes-tab"
      data-bs-toggle="tab"
      data-bs-target="#source-nodes"
      type="button"
    >
      ğŸ”§ æºèŠ‚ç‚¹ç®¡ç†
    </button>
  </li>
  ```

**2. NAT64 æºèŠ‚ç‚¹é…ç½®é¢æ¿**

- **NAT64 é…ç½®ç•Œé¢**ï¼š
  ```html
  <div class="source-node-config" id="nat64-config">
    <h4>ğŸŒ NAT64æºèŠ‚ç‚¹é…ç½®</h4>
    <div class="row">
      <div class="col-md-6">
        <label class="form-label">é…ç½®åç§°ï¼š</label>
        <input
          type="text"
          class="form-control"
          id="nat64-name"
          placeholder="ä¾‹å¦‚ï¼šNAT64-æ•™è‚²ç½‘"
        />
      </div>
      <div class="col-md-6">
        <label class="form-label">WorkeråŸŸåï¼š</label>
        <input
          type="text"
          class="form-control"
          id="nat64-domain"
          placeholder="your-worker.workers.dev"
        />
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-6">
        <label class="form-label">UUIDï¼š</label>
        <input
          type="text"
          class="form-control"
          id="nat64-uuid"
          placeholder="è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥"
        />
        <button
          class="btn btn-sm btn-outline-secondary mt-1"
          onclick="generateUUID('nat64-uuid')"
        >
          ğŸ² ç”ŸæˆUUID
        </button>
      </div>
      <div class="col-md-6">
        <label class="form-label">NAT64å‰ç¼€ï¼š</label>
        <input
          type="text"
          class="form-control"
          id="nat64-prefix"
          value="2602:fc59:b0:64::"
        />
      </div>
    </div>
    <div class="mt-3">
      <button class="btn btn-primary" onclick="generateNAT64Node()">
        ğŸš€ ç”ŸæˆNAT64æºèŠ‚ç‚¹
      </button>
      <button class="btn btn-success ms-2" onclick="saveNAT64Config()">
        ğŸ’¾ ä¿å­˜é…ç½®
      </button>
    </div>
    <div class="mt-3">
      <label class="form-label">ç”Ÿæˆçš„æºèŠ‚ç‚¹ï¼š</label>
      <textarea
        class="form-control"
        id="nat64-result"
        rows="3"
        readonly
        placeholder="ç‚¹å‡»ç”ŸæˆæŒ‰é’®åæ˜¾ç¤º"
      ></textarea>
      <button
        class="btn btn-outline-primary btn-sm mt-1"
        onclick="copyToClipboard('nat64-result')"
      >
        ğŸ“‹ å¤åˆ¶èŠ‚ç‚¹
      </button>
    </div>
  </div>
  ```

**3. ProxyIP æºèŠ‚ç‚¹é…ç½®é¢æ¿**

- **ProxyIP é…ç½®ç•Œé¢**ï¼š
  ```html
  <div class="source-node-config" id="proxyip-config">
    <h4>ğŸ¯ ProxyIPæºèŠ‚ç‚¹é…ç½®</h4>
    <div class="row">
      <div class="col-md-6">
        <label class="form-label">é…ç½®åç§°ï¼š</label>
        <input
          type="text"
          class="form-control"
          id="proxyip-name"
          placeholder="ä¾‹å¦‚ï¼šProxyIP-ä¼˜é€‰"
        />
      </div>
      <div class="col-md-6">
        <label class="form-label">WorkeråŸŸåï¼š</label>
        <input
          type="text"
          class="form-control"
          id="proxyip-domain"
          placeholder="your-worker.workers.dev"
        />
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-6">
        <label class="form-label">UUIDï¼š</label>
        <input
          type="text"
          class="form-control"
          id="proxyip-uuid"
          placeholder="è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥"
        />
        <button
          class="btn btn-sm btn-outline-secondary mt-1"
          onclick="generateUUID('proxyip-uuid')"
        >
          ğŸ² ç”ŸæˆUUID
        </button>
      </div>
      <div class="col-md-6">
        <label class="form-label">ProxyIPåœ°å€ï¼š</label>
        <input
          type="text"
          class="form-control"
          id="proxyip-address"
          placeholder="1.2.3.4:443 æˆ– example.com:443"
        />
        <small class="form-text text-muted"
          >æ”¯æŒIPv4ã€IPv6ã€åŸŸåï¼Œå¯å¸¦ç«¯å£</small
        >
      </div>
    </div>
    <div class="mt-3">
      <button class="btn btn-primary" onclick="generateProxyIPNode()">
        ğŸš€ ç”ŸæˆProxyIPæºèŠ‚ç‚¹
      </button>
      <button class="btn btn-success ms-2" onclick="saveProxyIPConfig()">
        ğŸ’¾ ä¿å­˜é…ç½®
      </button>
    </div>
    <div class="mt-3">
      <label class="form-label">ç”Ÿæˆçš„æºèŠ‚ç‚¹ï¼š</label>
      <textarea
        class="form-control"
        id="proxyip-result"
        rows="3"
        readonly
        placeholder="ç‚¹å‡»ç”ŸæˆæŒ‰é’®åæ˜¾ç¤º"
      ></textarea>
      <button
        class="btn btn-outline-primary btn-sm mt-1"
        onclick="copyToClipboard('proxyip-result')"
      >
        ğŸ“‹ å¤åˆ¶èŠ‚ç‚¹
      </button>
    </div>
  </div>
  ```

**4. å·²ä¿å­˜é…ç½®ç®¡ç†**

- **é…ç½®åˆ—è¡¨ç•Œé¢**ï¼š
  ```html
  <div class="saved-configs mt-4">
    <h4>ğŸ“‹ å·²ä¿å­˜çš„æºèŠ‚ç‚¹é…ç½®</h4>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>é…ç½®åç§°</th>
            <th>èŠ‚ç‚¹ç±»å‹</th>
            <th>åŸŸå</th>
            <th>çŠ¶æ€</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="saved-configs-list">
          <!-- åŠ¨æ€åŠ è½½å·²ä¿å­˜çš„é…ç½® -->
        </tbody>
      </table>
    </div>
  </div>
  ```

#### é˜¶æ®µä¸‰ï¼šæ ¸å¿ƒåŠŸèƒ½é›†æˆ (ä¼˜å…ˆçº§ï¼šé«˜)

**1. JavaScript åŠŸèƒ½å®ç°**

- **æºèŠ‚ç‚¹ç”Ÿæˆå‡½æ•°**ï¼š

  ```javascript
  // UUIDç”Ÿæˆå‡½æ•°
  function generateUUID(inputId) {
    const uuid = crypto.randomUUID();
    document.getElementById(inputId).value = uuid;
  }

  // NAT64æºèŠ‚ç‚¹ç”Ÿæˆ
  async function generateNAT64Node() {
    const config = {
      name: document.getElementById("nat64-name").value,
      domain: document.getElementById("nat64-domain").value,
      uuid: document.getElementById("nat64-uuid").value,
      prefix: document.getElementById("nat64-prefix").value,
    };

    if (!config.uuid) {
      generateUUID("nat64-uuid");
      config.uuid = document.getElementById("nat64-uuid").value;
    }

    const sourceNode = `vless://${config.uuid}@${
      config.domain
    }:443?encryption=none&security=tls&type=ws&host=${
      config.domain
    }&path=%2F%3Fed%3D2560&sni=${config.domain}#NAT64_${
      config.name || "Enhanced"
    }`;
    document.getElementById("nat64-result").value = sourceNode;
  }

  // ProxyIPæºèŠ‚ç‚¹ç”Ÿæˆ
  async function generateProxyIPNode() {
    const config = {
      name: document.getElementById("proxyip-name").value,
      domain: document.getElementById("proxyip-domain").value,
      uuid: document.getElementById("proxyip-uuid").value,
      proxyIP: document.getElementById("proxyip-address").value,
    };

    if (!config.uuid) {
      generateUUID("proxyip-uuid");
      config.uuid = document.getElementById("proxyip-uuid").value;
    }

    const sourceNode = `vless://${config.uuid}@${
      config.domain
    }:443?encryption=none&security=tls&type=ws&host=${
      config.domain
    }&path=%2F%3Fed%3D2560&sni=${config.domain}#ProxyIP_${
      config.name || "Enhanced"
    }`;
    document.getElementById("proxyip-result").value = sourceNode;
  }
  ```

**2. é…ç½®ä¿å­˜å’Œç®¡ç†**

- **ä¿å­˜é…ç½®åˆ°æ•°æ®åº“**ï¼š

  ```javascript
  // ä¿å­˜NAT64é…ç½®
  async function saveNAT64Config() {
    const config = {
      name: document.getElementById("nat64-name").value,
      domain: document.getElementById("nat64-domain").value,
      uuid: document.getElementById("nat64-uuid").value,
      prefix: document.getElementById("nat64-prefix").value,
      sourceNode: document.getElementById("nat64-result").value,
    };

    const response = await fetch("/api/source-nodes", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        config_name: config.name,
        node_type: "nat64",
        config_data: JSON.stringify(config),
        generated_node: config.sourceNode,
      }),
    });

    if (response.ok) {
      alert("NAT64é…ç½®ä¿å­˜æˆåŠŸï¼");
      loadSavedConfigs();
    }
  }

  // ä¿å­˜ProxyIPé…ç½®
  async function saveProxyIPConfig() {
    const config = {
      name: document.getElementById("proxyip-name").value,
      domain: document.getElementById("proxyip-domain").value,
      uuid: document.getElementById("proxyip-uuid").value,
      proxyIP: document.getElementById("proxyip-address").value,
      sourceNode: document.getElementById("proxyip-result").value,
    };

    const response = await fetch("/api/source-nodes", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        config_name: config.name,
        node_type: "proxyip",
        config_data: JSON.stringify(config),
        generated_node: config.sourceNode,
      }),
    });

    if (response.ok) {
      alert("ProxyIPé…ç½®ä¿å­˜æˆåŠŸï¼");
      loadSavedConfigs();
    }
  }
  ```

**3. ä¸ç°æœ‰èŠ‚ç‚¹ç”Ÿæˆå™¨çš„é›†æˆ**

- **ä¸€é”®å¯¼å…¥åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨**ï¼š

  ```javascript
  // å°†æºèŠ‚ç‚¹å¯¼å…¥åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨
  function importToNodeGenerator(sourceNode) {
    // åˆ‡æ¢åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨æ ‡ç­¾é¡µ
    document.getElementById("generator-tab").click();

    // å°†æºèŠ‚ç‚¹å¡«å…¥æ¨¡æ¿URLè¾“å…¥æ¡†
    document.getElementById("templateUrl").value = sourceNode;

    // è§¦å‘æ ¼å¼è‡ªåŠ¨è¯†åˆ«
    document.getElementById("templateUrl").dispatchEvent(new Event("input"));

    alert("æºèŠ‚ç‚¹å·²å¯¼å…¥åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨ï¼Œç°åœ¨å¯ä»¥æ‰©å±•ç”Ÿæˆæ›´å¤šèŠ‚ç‚¹ï¼");
  }
  ```

#### é˜¶æ®µå››ï¼šåç«¯ API æ‰©å±• (ä¼˜å…ˆçº§ï¼šé«˜)

**1. æºèŠ‚ç‚¹ç®¡ç† API**

- **ä¿å­˜æºèŠ‚ç‚¹é…ç½®**ï¼š

  ```javascript
  // åœ¨_worker.jsä¸­æ·»åŠ æ–°çš„APIè·¯ç”±
  case '/api/source-nodes':
    if (request.method === 'POST') {
      const user = await getUserBySession(request, env);
      if (!user) return new Response(JSON.stringify({ error: 'æœªæˆæƒ' }), { status: 401 });

      const { config_name, node_type, config_data, generated_node } = await request.json();

      const result = await env.DB.prepare(
        "INSERT INTO source_node_configs (user_id, config_name, node_type, config_data, generated_node) VALUES (?, ?, ?, ?, ?)"
      ).bind(user.id, config_name, node_type, config_data, generated_node).run();

      return new Response(JSON.stringify({ success: true, id: result.meta.last_row_id }));
    }
    break;
  ```

**2. è·å–å·²ä¿å­˜é…ç½®**ï¼š

```javascript
case '/api/source-nodes':
  if (request.method === 'GET') {
    const user = await getUserBySession(request, env);
    if (!user) return new Response(JSON.stringify({ error: 'æœªæˆæƒ' }), { status: 401 });

    const configs = await env.DB.prepare(
      "SELECT * FROM source_node_configs WHERE user_id = ? ORDER BY created_at DESC"
    ).bind(user.id).all();

    return new Response(JSON.stringify(configs.results));
  }
  break;
```

### ğŸ—„ï¸ æ•°æ®åº“æ¶æ„æ‰©å±•

```sql
-- æºèŠ‚ç‚¹é…ç½®è¡¨ï¼ˆå·²åœ¨é˜¶æ®µä¸€å®šä¹‰ï¼Œè¿™é‡Œæ˜¯å®Œæ•´ç‰ˆæœ¬ï¼‰
CREATE TABLE source_node_configs (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,
    config_name TEXT NOT NULL,
    node_type TEXT NOT NULL, -- 'nat64' æˆ– 'proxyip'
    config_data TEXT NOT NULL, -- JSONæ ¼å¼çš„é…ç½®æ•°æ®
    generated_node TEXT NOT NULL, -- ç”Ÿæˆçš„æºèŠ‚ç‚¹é“¾æ¥
    enabled BOOLEAN DEFAULT true,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);

-- ä¸ºæºèŠ‚ç‚¹é…ç½®è¡¨åˆ›å»ºç´¢å¼•
CREATE INDEX idx_source_node_configs_user_id ON source_node_configs(user_id);
CREATE INDEX idx_source_node_configs_node_type ON source_node_configs(node_type);
```

### ğŸ”§ æŠ€æœ¯å®ç°æ¶æ„

#### 1. æ ¸å¿ƒå·¥ä½œæµç¨‹

```
ç”¨æˆ·é…ç½® â†’ æºèŠ‚ç‚¹ç”Ÿæˆ â†’ å¤åˆ¶åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨ â†’ æ‰©å±•ç”Ÿæˆå¤šèŠ‚ç‚¹ â†’ Tagç®¡ç†
    â†“           â†“              â†“                â†“              â†“
WebUIé…ç½®   NAT64/ProxyIP   ç°æœ‰ç”Ÿæˆå™¨åŠŸèƒ½    æ‰¹é‡èŠ‚ç‚¹ç”Ÿæˆ    ç°æœ‰Tagç³»ç»Ÿ
```

#### 2. æºèŠ‚ç‚¹ç”Ÿæˆé€»è¾‘

```javascript
// æ ¸å¿ƒç”Ÿæˆé€»è¾‘
function generateSourceNode(type, config) {
  const baseTemplate = `vless://${config.uuid}@${config.domain}:443?encryption=none&security=tls&type=ws&host=${config.domain}&path=%2F%3Fed%3D2560&sni=${config.domain}`;

  switch (type) {
    case "nat64":
      return `${baseTemplate}#NAT64_${config.name}`;
    case "proxyip":
      return `${baseTemplate}#ProxyIP_${config.name}`;
    default:
      return baseTemplate;
  }
}
```

#### 3. ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆç‚¹

```javascript
// é›†æˆç°æœ‰èŠ‚ç‚¹ç”Ÿæˆå™¨
function integrateWithExistingGenerator() {
  // 1. æºèŠ‚ç‚¹ â†’ æ¨¡æ¿URLè¾“å…¥æ¡†
  // 2. åˆ©ç”¨ç°æœ‰çš„åœ°å€æ± å’Œç«¯å£é…ç½®
  // 3. ä½¿ç”¨ç°æœ‰çš„æ ¼å¼è½¬æ¢åŠŸèƒ½
  // 4. è¾“å‡ºåˆ°ç°æœ‰çš„Tagç®¡ç†ç³»ç»Ÿ
}
```

### ğŸš€ å¼€å‘é‡Œç¨‹ç¢‘ - è¯¦ç»†ä»»åŠ¡åˆ†è§£

#### ğŸ“‹ é¡¹ç›® 1: æ•°æ®åº“æ¶æ„æ‰©å±• (é¢„è®¡ 1-2 å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **1.1** æ‰©å±• users è¡¨ï¼Œæ·»åŠ  user_uuid å­—æ®µ
  ```sql
  ALTER TABLE users ADD COLUMN user_uuid TEXT UNIQUE;
  CREATE INDEX idx_users_uuid ON users(user_uuid);
  ```
- [ ] **1.2** åˆ›å»º source_node_configs è¡¨
  ```sql
  CREATE TABLE source_node_configs (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,
    config_name TEXT NOT NULL,
    node_type TEXT NOT NULL, -- 'nat64' æˆ– 'proxyip'
    config_data TEXT NOT NULL, -- JSONæ ¼å¼é…ç½®
    generated_node TEXT NOT NULL, -- ç”Ÿæˆçš„æºèŠ‚ç‚¹é“¾æ¥
    is_default BOOLEAN DEFAULT false,
    enabled BOOLEAN DEFAULT true,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
  );
  ```
- [ ] **1.3** åˆ›å»ºç›¸å…³ç´¢å¼•
  ```sql
  CREATE INDEX idx_source_node_configs_user_id ON source_node_configs(user_id);
  CREATE INDEX idx_source_node_configs_node_type ON source_node_configs(node_type);
  ```
- [ ] **1.4** æµ‹è¯•æ•°æ®åº“è¿ç§»è„šæœ¬

#### ğŸ“‹ é¡¹ç›® 2: ç”¨æˆ·æ³¨å†Œé€»è¾‘æ‰©å±• (é¢„è®¡ 2-3 å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **2.1** ä¿®æ”¹ç”¨æˆ·æ³¨å†Œ APIï¼Œè‡ªåŠ¨åˆ†é… UUID
  ```javascript
  // åœ¨æ³¨å†Œæ—¶ç”Ÿæˆç”¨æˆ·ä¸“å±UUID
  const userUUID = crypto.randomUUID();
  ```
- [ ] **2.2** å®ç°é»˜è®¤ NAT64 æºèŠ‚ç‚¹åˆ›å»ºå‡½æ•°
  ```javascript
  async function createDefaultNAT64Config(userId, userUUID, env)
  ```
- [ ] **2.3** å®ç°é»˜è®¤ ProxyIP æºèŠ‚ç‚¹åˆ›å»ºå‡½æ•°
  ```javascript
  async function createDefaultProxyIPConfig(userId, userUUID, env)
  ```
- [ ] **2.4** é›†æˆåˆ°ç°æœ‰æ³¨å†Œæµç¨‹
- [ ] **2.5** å¤„ç†ç°æœ‰ç”¨æˆ·çš„ UUID åˆ†é…ï¼ˆæ•°æ®è¿ç§»ï¼‰
- [ ] **2.6** æµ‹è¯•æ³¨å†Œæµç¨‹å’Œé»˜è®¤èŠ‚ç‚¹åˆ›å»º

#### ğŸ“‹ é¡¹ç›® 3: NAT64 æ ¸å¿ƒé€»è¾‘é›†æˆ (é¢„è®¡ 3-4 å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **3.1** ä»\_workernat64.js æå– NAT64 æ ¸å¿ƒå‡½æ•°
  - [ ] `convertToNAT64IPv6()` å‡½æ•°
  - [ ] `getIPv6ProxyAddress()` å‡½æ•°
  - [ ] NAT64 é‡è¯•æœºåˆ¶
- [ ] **3.2** é›†æˆåˆ°ç°æœ‰\_worker.js ä¸­
  - [ ] æ·»åŠ  NAT64 å¤„ç†è·¯ç”±
  - [ ] é›†æˆ WebSocket å¤„ç†é€»è¾‘
- [ ] **3.3** å®ç° NAT64 é…ç½®éªŒè¯
- [ ] **3.4** æ·»åŠ  NAT64 ç›¸å…³çš„ç¯å¢ƒå˜é‡æ”¯æŒ
- [ ] **3.5** æµ‹è¯• NAT64 åŠŸèƒ½

#### ğŸ“‹ é¡¹ç›® 4: ProxyIP æ ¸å¿ƒé€»è¾‘é›†æˆ (é¢„è®¡ 3-4 å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **4.1** ä» vlessnoproxyip.js æå– ProxyIP æ ¸å¿ƒå‡½æ•°
  - [ ] ProxyIP è§£æé€»è¾‘
  - [ ] è¿æ¥é‡è¯•æœºåˆ¶
  - [ ] IPv4/IPv6 åœ°å€å¤„ç†
- [ ] **4.2** é›†æˆåˆ°ç°æœ‰\_worker.js ä¸­
  - [ ] æ·»åŠ  ProxyIP å¤„ç†è·¯ç”±
  - [ ] é›†æˆè¿æ¥å¤„ç†é€»è¾‘
- [ ] **4.3** å®ç° ProxyIP é…ç½®éªŒè¯
- [ ] **4.4** æ”¯æŒåŠ¨æ€ ProxyIP é…ç½®
- [ ] **4.5** æµ‹è¯• ProxyIP åŠŸèƒ½

#### ğŸ“‹ é¡¹ç›® 5: WebUI ç•Œé¢æ‰©å±• (é¢„è®¡ 4-5 å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **5.1** æ·»åŠ æºèŠ‚ç‚¹ç®¡ç†æ ‡ç­¾é¡µ
  ```html
  <li class="nav-item">
    <button class="nav-link" id="source-nodes-tab">ğŸ”§ æºèŠ‚ç‚¹ç®¡ç†</button>
  </li>
  ```
- [ ] **5.2** åˆ›å»º NAT64 é…ç½®é¢æ¿
  - [ ] é…ç½®åç§°è¾“å…¥
  - [ ] Worker åŸŸåé…ç½®
  - [ ] UUID æ˜¾ç¤ºå’Œç”Ÿæˆ
  - [ ] NAT64 å‰ç¼€é…ç½®
- [ ] **5.3** åˆ›å»º ProxyIP é…ç½®é¢æ¿
  - [ ] é…ç½®åç§°è¾“å…¥
  - [ ] Worker åŸŸåé…ç½®
  - [ ] UUID æ˜¾ç¤ºå’Œç”Ÿæˆ
  - [ ] ProxyIP åœ°å€é…ç½®
- [ ] **5.4** å®ç°é»˜è®¤æºèŠ‚ç‚¹æ˜¾ç¤º
- [ ] **5.5** æ·»åŠ é…ç½®ä¿å­˜å’Œç®¡ç†åŠŸèƒ½
- [ ] **5.6** å®ç°ä¸€é”®å¤åˆ¶å’Œå¯¼å…¥åŠŸèƒ½

#### ğŸ“‹ é¡¹ç›® 6: åç«¯ API æ‰©å±• (é¢„è®¡ 2-3 å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **6.1** å®ç°æºèŠ‚ç‚¹é…ç½®ä¿å­˜ API
  ```javascript
  POST / api / source - nodes;
  ```
- [ ] **6.2** å®ç°æºèŠ‚ç‚¹é…ç½®è·å– API
  ```javascript
  GET / api / source - nodes;
  ```
- [ ] **6.3** å®ç°æºèŠ‚ç‚¹é…ç½®æ›´æ–° API
  ```javascript
  PUT /api/source-nodes/:id
  ```
- [ ] **6.4** å®ç°æºèŠ‚ç‚¹é…ç½®åˆ é™¤ API
  ```javascript
  DELETE /api/source-nodes/:id
  ```
- [ ] **6.5** æ·»åŠ æƒé™éªŒè¯å’Œç”¨æˆ·ç»‘å®šæ£€æŸ¥
- [ ] **6.6** å®ç°é…ç½®é‡ç½®åŠŸèƒ½

#### ğŸ“‹ é¡¹ç›® 7: å‰ç«¯ JavaScript åŠŸèƒ½ (é¢„è®¡ 3-4 å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **7.1** å®ç° UUID ç”Ÿæˆå‡½æ•°
  ```javascript
  function generateUUID(inputId)
  ```
- [ ] **7.2** å®ç° NAT64 æºèŠ‚ç‚¹ç”Ÿæˆå‡½æ•°
  ```javascript
  async function generateNAT64Node()
  ```
- [ ] **7.3** å®ç° ProxyIP æºèŠ‚ç‚¹ç”Ÿæˆå‡½æ•°
  ```javascript
  async function generateProxyIPNode()
  ```
- [ ] **7.4** å®ç°é…ç½®ä¿å­˜å‡½æ•°
  ```javascript
  async function saveNAT64Config()
  async function saveProxyIPConfig()
  ```
- [ ] **7.5** å®ç°é…ç½®åŠ è½½å’Œæ˜¾ç¤ºå‡½æ•°
- [ ] **7.6** å®ç°ä¸€é”®å¯¼å…¥åˆ°èŠ‚ç‚¹ç”Ÿæˆå™¨åŠŸèƒ½
- [ ] **7.7** æ·»åŠ è¡¨å•éªŒè¯å’Œé”™è¯¯å¤„ç†

#### ğŸ“‹ é¡¹ç›® 8: ç³»ç»Ÿé›†æˆå’Œæµ‹è¯• (é¢„è®¡ 2-3 å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **8.1** é›†æˆæµ‹è¯•æ‰€æœ‰æ–°åŠŸèƒ½
- [ ] **8.2** æµ‹è¯•ä¸ç°æœ‰èŠ‚ç‚¹ç”Ÿæˆå™¨çš„å…¼å®¹æ€§
- [ ] **8.3** æµ‹è¯•ä¸ç°æœ‰ Tag ç®¡ç†çš„é›†æˆ
- [ ] **8.4** æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- [ ] **8.5** é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] **8.6** ç”¨æˆ·ä½“éªŒæµ‹è¯•å’Œä¼˜åŒ–

#### ğŸ“‹ é¡¹ç›® 9: æ–‡æ¡£å’Œéƒ¨ç½² (é¢„è®¡ 1-2 å¤©)

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **9.1** æ›´æ–°ç”¨æˆ·ä½¿ç”¨è¯´æ˜
- [ ] **9.2** æ·»åŠ æºèŠ‚ç‚¹ç®¡ç†çš„å¸®åŠ©æ–‡æ¡£
- [ ] **9.3** æ›´æ–° API æ–‡æ¡£
- [ ] **9.4** åˆ›å»ºéƒ¨ç½²å’Œé…ç½®æŒ‡å—
- [ ] **9.5** æœ€ç»ˆæµ‹è¯•å’Œéƒ¨ç½²

### ğŸ“Š æ€»ä½“æ—¶é—´ä¼°ç®—

| é¡¹ç›®                 | é¢„è®¡æ—¶é—´ | ä¾èµ–å…³ç³»         |
| -------------------- | -------- | ---------------- |
| é¡¹ç›® 1: æ•°æ®åº“æ‰©å±•   | 1-2 å¤©   | æ—                |
| é¡¹ç›® 2: ç”¨æˆ·æ³¨å†Œæ‰©å±• | 2-3 å¤©   | ä¾èµ–é¡¹ç›® 1       |
| é¡¹ç›® 3: NAT64 é›†æˆ   | 3-4 å¤©   | ä¾èµ–é¡¹ç›® 1       |
| é¡¹ç›® 4: ProxyIP é›†æˆ | 3-4 å¤©   | ä¾èµ–é¡¹ç›® 1       |
| é¡¹ç›® 5: WebUI æ‰©å±•   | 4-5 å¤©   | ä¾èµ–é¡¹ç›® 2       |
| é¡¹ç›® 6: API æ‰©å±•     | 2-3 å¤©   | ä¾èµ–é¡¹ç›® 1,2     |
| é¡¹ç›® 7: å‰ç«¯åŠŸèƒ½     | 3-4 å¤©   | ä¾èµ–é¡¹ç›® 5,6     |
| é¡¹ç›® 8: é›†æˆæµ‹è¯•     | 2-3 å¤©   | ä¾èµ–æ‰€æœ‰å‰é¢é¡¹ç›® |
| é¡¹ç›® 9: æ–‡æ¡£éƒ¨ç½²     | 1-2 å¤©   | ä¾èµ–é¡¹ç›® 8       |

**æ€»è®¡ï¼š21-30 å¤© (çº¦ 3-4 å‘¨)**

### ğŸ¯ å»ºè®®çš„å¼€å‘é¡ºåº

**ç¬¬ä¸€å‘¨ï¼šåŸºç¡€æ¶æ„**

- é¡¹ç›® 1: æ•°æ®åº“æ‰©å±•
- é¡¹ç›® 2: ç”¨æˆ·æ³¨å†Œæ‰©å±•
- é¡¹ç›® 3: NAT64 é›†æˆ

**ç¬¬äºŒå‘¨ï¼šæ ¸å¿ƒåŠŸèƒ½**

- é¡¹ç›® 4: ProxyIP é›†æˆ
- é¡¹ç›® 5: WebUI æ‰©å±•

**ç¬¬ä¸‰å‘¨ï¼šåŠŸèƒ½å®Œå–„**

- é¡¹ç›® 6: API æ‰©å±•
- é¡¹ç›® 7: å‰ç«¯åŠŸèƒ½

**ç¬¬å››å‘¨ï¼šæµ‹è¯•éƒ¨ç½²**

- é¡¹ç›® 8: é›†æˆæµ‹è¯•
- é¡¹ç›® 9: æ–‡æ¡£éƒ¨ç½²

### ğŸ’¡ æ ¸å¿ƒä»·å€¼å’Œåˆ›æ–°ç‚¹

#### 1. **å®Œç¾çš„åŠŸèƒ½é—­ç¯**

```
æºèŠ‚ç‚¹é…ç½® â†’ æºèŠ‚ç‚¹ç”Ÿæˆ â†’ èŠ‚ç‚¹æ‰©å±• â†’ Tagç®¡ç† â†’ è®¢é˜…è¾“å‡º
     â†‘                                              â†“
   WebUIé…ç½® â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â† å®Œæ•´çš„ç®¡ç†æµç¨‹
```

#### 2. **æŠ€æœ¯åˆ›æ–°ç‚¹**

- **é¦–ä¸ªé›†æˆ NAT64 å’Œ ProxyIP çš„è®¢é˜…ç®¡ç†å¹³å°**
- **æºèŠ‚ç‚¹ + èŠ‚ç‚¹ç”Ÿæˆå™¨çš„åŒé‡æ‰©å±•èƒ½åŠ›**
- **åŸºäºç°æœ‰æ¶æ„çš„æ— ç¼é›†æˆ**
- **é€‚é… Cloudflare Workers/Pages çš„è½»é‡åŒ–è®¾è®¡**

#### 3. **ç”¨æˆ·ä»·å€¼**

- **ç®€åŒ–é…ç½®**ï¼šé€šè¿‡ WebUI è½»æ¾é…ç½® NAT64 å’Œ ProxyIP
- **æ‰©å±•èƒ½åŠ›**ï¼šä¸€ä¸ªæºèŠ‚ç‚¹å¯ä»¥æ‰©å±•å‡ºæ•°ç™¾ä¸ªèŠ‚ç‚¹
- **ç®¡ç†ä¾¿æ·**ï¼šä¸ç°æœ‰ Tag ç³»ç»Ÿå®Œç¾é›†æˆ
- **å³æ’å³ç”¨**ï¼šç”Ÿæˆçš„æºèŠ‚ç‚¹å¯ç›´æ¥ç”¨äºèŠ‚ç‚¹ç”Ÿæˆå™¨

### ğŸ¯ å®æ–½å»ºè®®

#### ç«‹å³å¼€å§‹çš„ç¬¬ä¸€æ­¥ï¼š

1. **æ‰©å±•æ•°æ®åº“**ï¼šæ·»åŠ æºèŠ‚ç‚¹é…ç½®è¡¨
2. **åˆ›å»º WebUI ç•Œé¢**ï¼šåœ¨ç°æœ‰ç•Œé¢ä¸­æ·»åŠ æ–°æ ‡ç­¾é¡µ
3. **å®ç°åŸºç¡€ç”ŸæˆåŠŸèƒ½**ï¼šNAT64 å’Œ ProxyIP æºèŠ‚ç‚¹ç”Ÿæˆ

#### æ ¸å¿ƒä¼˜åŠ¿ï¼š

- **åŸºäºç°æœ‰æ¶æ„**ï¼šæœ€å°åŒ–å¼€å‘æˆæœ¬
- **å……åˆ†åˆ©ç”¨ç°æœ‰åŠŸèƒ½**ï¼šèŠ‚ç‚¹ç”Ÿæˆå™¨ã€Tag ç®¡ç†ã€è®¢é˜…è¾“å‡º
- **ç¬¦åˆ Cloudflare é™åˆ¶**ï¼šè½»é‡åŒ–ã€é«˜æ•ˆçš„å®ç°æ–¹æ¡ˆ
- **ç”¨æˆ·å‹å¥½**ï¼šç®€å•çš„é…ç½®ç•Œé¢ï¼Œå¼ºå¤§çš„æ‰©å±•èƒ½åŠ›

è¿™ä¸ªæ–¹æ¡ˆå®Œç¾å¥‘åˆä½ çš„æ„æ€ï¼š**é€šè¿‡ WebUI é…ç½®ç”Ÿæˆ NAT64 å’Œ ProxyIP æºèŠ‚ç‚¹ï¼Œç„¶ååˆ©ç”¨ç°æœ‰çš„èŠ‚ç‚¹ç”Ÿæˆå™¨æ‰©å±•å‡ºæ›´å¤šèŠ‚ç‚¹ï¼Œå½¢æˆå®Œæ•´çš„èŠ‚ç‚¹ç”Ÿæˆå’Œç®¡ç†é—­ç¯**ï¼ğŸ¯

---

## ğŸ” UUID ç®¡ç†å’Œå®‰å…¨æœºåˆ¶ä¼˜åŒ–

### ğŸ“‹ ç”¨æˆ·ç†è§£ç¡®è®¤

ä½ çš„é€»è¾‘å®Œå…¨æ­£ç¡®ï¼è®©æˆ‘ç¡®è®¤ä¸€ä¸‹æ ¸å¿ƒè¦ç‚¹ï¼š

#### 1. **UUID ç®¡ç†ç­–ç•¥**

- **ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ†é… UUID**ï¼šæ¯ä¸ªç”¨æˆ·è´¦å·å¯¹åº”ä¸€ä¸ªå”¯ä¸€ UUID
- **æ›¿ä»£ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼šä¸å†ä½¿ç”¨"UUID + Pages URL"çš„å…¬å¼€è®¿é—®æ–¹å¼
- **å®‰å…¨æ€§æå‡**ï¼šUUID ä¸ç”¨æˆ·è´¦å·ç»‘å®šï¼Œé˜²æ­¢æ‰«æå’Œæ»¥ç”¨
- **WebUI ç®¡ç†**ï¼šé€šè¿‡ç™»å½•åçš„ç•Œé¢è¿›è¡ŒèŠ‚ç‚¹ç”Ÿæˆå’Œç®¡ç†

#### 2. **é»˜è®¤æºèŠ‚ç‚¹æœºåˆ¶**

- **è‡ªåŠ¨åˆ›å»º**ï¼šç”¨æˆ·æ³¨å†Œæ—¶é»˜è®¤åˆ›å»º NAT64 å’Œ ProxyIP ä¸¤ä¸ªæºèŠ‚ç‚¹
- **åŸºç¡€èŠ‚ç‚¹**ï¼šè¿™ä¸¤ä¸ªæºèŠ‚ç‚¹ä½œä¸ºç”¨æˆ·çš„åŸºç¡€ä»£ç†èŠ‚ç‚¹
- **æ‰©å±•èƒ½åŠ›**ï¼šç”¨æˆ·å¯ä»¥åŸºäºè¿™ä¸¤ä¸ªæºèŠ‚ç‚¹ç”Ÿæˆæ›´å¤šèŠ‚ç‚¹
- **ä¿æŒå…¼å®¹**ï¼šåŸæœ‰çš„å¯¼å…¥è®¢é˜…åŠŸèƒ½ç»§ç»­ä¿æŒ

### ğŸ”§ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

#### 1. **ç”¨æˆ·æ³¨å†Œæ—¶çš„ UUID åˆ†é…**

```javascript
// åœ¨ç”¨æˆ·æ³¨å†ŒAPIä¸­
async function registerUser(username, password, env) {
  // ç”Ÿæˆç”¨æˆ·ä¸“å±UUID
  const userUUID = crypto.randomUUID();

  // åˆ›å»ºç”¨æˆ·è´¦å·
  const userResult = await env.DB.prepare(
    "INSERT INTO users (username, password_hash, user_uuid) VALUES (?, ?, ?)"
  )
    .bind(username, hashedPassword, userUUID)
    .run();

  const userId = userResult.meta.last_row_id;

  // è‡ªåŠ¨åˆ›å»ºé»˜è®¤çš„NAT64æºèŠ‚ç‚¹é…ç½®
  await createDefaultNAT64Config(userId, userUUID, env);

  // è‡ªåŠ¨åˆ›å»ºé»˜è®¤çš„ProxyIPæºèŠ‚ç‚¹é…ç½®
  await createDefaultProxyIPConfig(userId, userUUID, env);

  return { userId, userUUID };
}
```

#### 2. **é»˜è®¤æºèŠ‚ç‚¹åˆ›å»º**

```javascript
// åˆ›å»ºé»˜è®¤NAT64æºèŠ‚ç‚¹
async function createDefaultNAT64Config(userId, userUUID, env) {
  const defaultDomain = "your-worker.workers.dev"; // æˆ–ä»ç¯å¢ƒå˜é‡è·å–
  const nat64Config = {
    name: "Default NAT64",
    domain: defaultDomain,
    uuid: userUUID,
    prefix: "2602:fc59:b0:64::",
  };

  const sourceNode = `vless://${userUUID}@${defaultDomain}:443?encryption=none&security=tls&type=ws&host=${defaultDomain}&path=%2F%3Fed%3D2560&sni=${defaultDomain}#NAT64_Default`;

  await env.DB.prepare(
    "INSERT INTO source_node_configs (user_id, config_name, node_type, config_data, generated_node, is_default) VALUES (?, ?, ?, ?, ?, ?)"
  )
    .bind(
      userId,
      "Default NAT64",
      "nat64",
      JSON.stringify(nat64Config),
      sourceNode,
      true
    )
    .run();
}

// åˆ›å»ºé»˜è®¤ProxyIPæºèŠ‚ç‚¹
async function createDefaultProxyIPConfig(userId, userUUID, env) {
  const defaultDomain = "your-worker.workers.dev";
  const proxyIPConfig = {
    name: "Default ProxyIP",
    domain: defaultDomain,
    uuid: userUUID,
    proxyIP: "", // ç”¨æˆ·å¯ä»¥åç»­é…ç½®
  };

  const sourceNode = `vless://${userUUID}@${defaultDomain}:443?encryption=none&security=tls&type=ws&host=${defaultDomain}&path=%2F%3Fed%3D2560&sni=${defaultDomain}#ProxyIP_Default`;

  await env.DB.prepare(
    "INSERT INTO source_node_configs (user_id, config_name, node_type, config_data, generated_node, is_default) VALUES (?, ?, ?, ?, ?, ?)"
  )
    .bind(
      userId,
      "Default ProxyIP",
      "proxyip",
      JSON.stringify(proxyIPConfig),
      sourceNode,
      true
    )
    .run();
}
```

#### 3. **æ•°æ®åº“æ¶æ„æ‰©å±•**

```sql
-- æ‰©å±•usersè¡¨ï¼Œæ·»åŠ user_uuidå­—æ®µ
ALTER TABLE users ADD COLUMN user_uuid TEXT UNIQUE;

-- æ‰©å±•source_node_configsè¡¨ï¼Œæ·»åŠ é»˜è®¤èŠ‚ç‚¹æ ‡è¯†
ALTER TABLE source_node_configs ADD COLUMN is_default BOOLEAN DEFAULT false;

-- åˆ›å»ºUUIDç´¢å¼•
CREATE INDEX idx_users_uuid ON users(user_uuid);
```

#### 4. **WebUI æ˜¾ç¤ºé»˜è®¤æºèŠ‚ç‚¹**

```javascript
// åŠ è½½ç”¨æˆ·çš„æºèŠ‚ç‚¹é…ç½®
async function loadUserSourceNodes() {
  const response = await fetch("/api/source-nodes");
  const configs = await response.json();

  // åˆ†ç¦»é»˜è®¤èŠ‚ç‚¹å’Œè‡ªå®šä¹‰èŠ‚ç‚¹
  const defaultNodes = configs.filter((config) => config.is_default);
  const customNodes = configs.filter((config) => !config.is_default);

  // åœ¨ç•Œé¢ä¸Šæ˜¾ç¤º
  displayDefaultNodes(defaultNodes);
  displayCustomNodes(customNodes);
}

// æ˜¾ç¤ºé»˜è®¤æºèŠ‚ç‚¹
function displayDefaultNodes(defaultNodes) {
  const container = document.getElementById("default-source-nodes");
  container.innerHTML = `
        <h4>ğŸ”§ é»˜è®¤æºèŠ‚ç‚¹</h4>
        <div class="alert alert-info">
            <small>è¿™äº›æ˜¯ç³»ç»Ÿä¸ºæ‚¨è‡ªåŠ¨åˆ›å»ºçš„åŸºç¡€æºèŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ–åŸºäºå®ƒä»¬æ‰©å±•æ›´å¤šèŠ‚ç‚¹ã€‚</small>
        </div>
    `;

  defaultNodes.forEach((node) => {
    container.innerHTML += `
            <div class="card mb-2">
                <div class="card-body">
                    <h6>${
                      node.config_name
                    } (${node.node_type.toUpperCase()})</h6>
                    <div class="input-group">
                        <input type="text" class="form-control" value="${
                          node.generated_node
                        }" readonly>
                        <button class="btn btn-outline-primary" onclick="copyToClipboard('${
                          node.generated_node
                        }')">ğŸ“‹</button>
                        <button class="btn btn-outline-success" onclick="importToNodeGenerator('${
                          node.generated_node
                        }')">ğŸš€ å¯¼å…¥ç”Ÿæˆå™¨</button>
                    </div>
                </div>
            </div>
        `;
  });
}
```

### ğŸ”’ å®‰å…¨æ€§æå‡

#### 1. **UUID ç»‘å®šéªŒè¯**

```javascript
// åœ¨Workerä¸­éªŒè¯UUIDä¸ç”¨æˆ·çš„ç»‘å®šå…³ç³»
async function validateUserUUID(request, env) {
  const url = new URL(request.url);
  const pathUUID = extractUUIDFromPath(url.pathname);

  if (pathUUID) {
    // éªŒè¯UUIDæ˜¯å¦å±äºå½“å‰ç”¨æˆ·
    const user = await getUserBySession(request, env);
    if (!user || user.user_uuid !== pathUUID) {
      return new Response("Unauthorized", { status: 401 });
    }
  }

  return null; // éªŒè¯é€šè¿‡
}
```

#### 2. **é˜²æ‰«ææœºåˆ¶**

- UUID ä¸ç”¨æˆ·è´¦å·ç»‘å®šï¼Œæ— æ³•é€šè¿‡æ‰«æè·å–
- éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®èŠ‚ç‚¹ç”ŸæˆåŠŸèƒ½
- å¯ä»¥æ·»åŠ è®¿é—®é¢‘ç‡é™åˆ¶

### ğŸ¯ ç”¨æˆ·ä½“éªŒæµç¨‹

#### 1. **æ–°ç”¨æˆ·æ³¨å†Œæµç¨‹**

```
ç”¨æˆ·æ³¨å†Œ â†’ è‡ªåŠ¨åˆ†é…UUID â†’ åˆ›å»ºé»˜è®¤æºèŠ‚ç‚¹ â†’ ç™»å½•åå³å¯ä½¿ç”¨
```

#### 2. **æ—¥å¸¸ä½¿ç”¨æµç¨‹**

```
ç™»å½• â†’ æŸ¥çœ‹é»˜è®¤æºèŠ‚ç‚¹ â†’ å¤åˆ¶æˆ–å¯¼å…¥åˆ°ç”Ÿæˆå™¨ â†’ æ‰©å±•ç”Ÿæˆæ›´å¤šèŠ‚ç‚¹ â†’ Tagç®¡ç†
```

#### 3. **é«˜çº§ç”¨æˆ·æµç¨‹**

```
ç™»å½• â†’ è‡ªå®šä¹‰ProxyIPé…ç½® â†’ åˆ›å»ºæ–°æºèŠ‚ç‚¹ â†’ å¤šæºèŠ‚ç‚¹ç®¡ç† â†’ æ‰¹é‡èŠ‚ç‚¹ç”Ÿæˆ
```

### â“ éœ€è¦ç¡®è®¤çš„ç»†èŠ‚

1. **åŸŸåé…ç½®**ï¼šé»˜è®¤æºèŠ‚ç‚¹ä½¿ç”¨å“ªä¸ªåŸŸåï¼Ÿæ˜¯å›ºå®šçš„ Worker åŸŸåè¿˜æ˜¯ç”¨æˆ·å¯é…ç½®ï¼Ÿ

2. **ProxyIP é»˜è®¤å€¼**ï¼šé»˜è®¤ ProxyIP æºèŠ‚ç‚¹æ˜¯å¦ç•™ç©ºï¼Œè®©ç”¨æˆ·è‡ªå·±é…ç½®ï¼Ÿè¿˜æ˜¯æä¾›ä¸€äº›é»˜è®¤çš„ä¼˜é€‰ IPï¼Ÿ

3. **èŠ‚ç‚¹å‘½å**ï¼šé»˜è®¤æºèŠ‚ç‚¹çš„å‘½åè§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦éœ€è¦åŒ…å«ç”¨æˆ·æ ‡è¯†ï¼Ÿ

4. **æ›´æ–°æœºåˆ¶**ï¼šç”¨æˆ·æ˜¯å¦å¯ä»¥ä¿®æ”¹é»˜è®¤æºèŠ‚ç‚¹çš„é…ç½®ï¼Ÿè¿˜æ˜¯åªèƒ½åˆ›å»ºæ–°çš„è‡ªå®šä¹‰æºèŠ‚ç‚¹ï¼Ÿ

ä½ çš„ç†è§£å’Œæˆ‘çš„åˆ†ææ˜¯å¦ä¸€è‡´ï¼Ÿæœ‰æ²¡æœ‰éœ€è¦è°ƒæ•´æˆ–è¡¥å……çš„åœ°æ–¹ï¼ŸğŸ¤”
